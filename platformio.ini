; PlatformIO Project Configuration File
; ESP32-S3 WROOM-1 N16R8 (16MB Flash + 8MB OPI PSRAM)

[env:esp32s3_n16r8]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino

; ============================================================================
; BOARD CONFIGURATION: ESP32-S3 WROOM-1 N16R8
; ============================================================================
; Hardware: ESP32-S3 WROOM-1 (16MB Flash + 8MB OPI PSRAM)
; 
; Pin mapping (via Level Shifter J1Y/BSS138):
;   GPIO 6  = PIN_PULSE (PU-)
;   GPIO 7  = PIN_DIR (DR-)
;   GPIO 15 = PIN_ENABLE (EN-)
;   GPIO 16 = PIN_PEND (PED- input)
;   GPIO 17 = PIN_ALM (ALM- input)
;   GPIO 5  = PIN_START_CONTACT (MIN - capteur opto jaune)
;   GPIO 4  = PIN_END_CONTACT (MAX - capteur opto vert)
;   GPIO 19 = PIN_AP_MODE (GND = normal, floating = AP mode)
; ============================================================================

; MCU configuration
board_build.mcu = esp32s3
board_build.f_cpu = 240000000L

; ============================================================================
; ESP32-S3 N16R8 Configuration: 16MB Flash + 8MB OPI PSRAM
; ============================================================================
board_build.flash_mode = qio
board_build.flash_size = 16MB
board_build.partitions = default_16MB.csv
board_build.arduino.memory_type = qio_opi

; PSRAM OPI (Octal, not Quad!)
board_build.arduino.psram_type = opi

; Filesystem
board_build.filesystem = littlefs

; ============================================================================
; OTA WIFI UPLOAD CONFIGURATION
; ============================================================================
upload_protocol = espota
upload_port = 192.168.1.85
upload_flags = 
    --port=3232
    --auth=REDACTED_OTA_PASSWORD
board_upload.flash_size = 16MB

upload_speed = 921600
monitor_speed = 115200
monitor_filters = esp32_exception_decoder

; ============================================================================
; BUILD FLAGS
; ============================================================================
build_flags = 
    -D CORE_DEBUG_LEVEL=3
    -D BOARD_HAS_PSRAM
    -D ARDUINO_ESP32S3_DEV
    -ffunction-sections
    -fdata-sections
    -D CONFIG_LWIP_MAX_SOCKETS=16
    -D ARDUINOJSON_ENABLE_PROGMEM=1
    -D CONFIG_ARDUHAL_LOG_COLORS=1
    -D ARDUINOJSON_USE_DOUBLE=0

build_unflags =

; Libraries
lib_deps = 
    links2004/WebSockets@^2.7.1
    bblanchon/ArduinoJson@^7.4.2

; ============================================================================
; USB UPLOAD ENVIRONMENT (for first flash or recovery)
; ============================================================================
; Usage: pio run -e esp32s3_usb -t upload
; ============================================================================
[env:esp32s3_usb]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino

board_build.mcu = esp32s3
board_build.f_cpu = 240000000L
board_build.flash_mode = qio
board_build.flash_size = 16MB
board_build.partitions = default_16MB.csv
board_build.arduino.memory_type = qio_opi
board_build.arduino.psram_type = opi
board_build.filesystem = littlefs

; USB Upload (auto-detect COM port)
upload_protocol = esptool
board_upload.flash_size = 16MB
upload_speed = 921600
monitor_speed = 115200
monitor_filters = esp32_exception_decoder

build_flags = 
    -D CORE_DEBUG_LEVEL=3
    -D BOARD_HAS_PSRAM
    -D ARDUINO_ESP32S3_DEV
    -ffunction-sections
    -fdata-sections
    -D CONFIG_LWIP_MAX_SOCKETS=16
    -D ARDUINOJSON_ENABLE_PROGMEM=1
    -D CONFIG_ARDUHAL_LOG_COLORS=1
    -D ARDUINOJSON_USE_DOUBLE=0

lib_deps = 
    links2004/WebSockets@^2.7.1
    bblanchon/ArduinoJson@^7.4.2