; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[env:freenove_esp32_s3_wroom]
platform = espressif32
board = freenove_esp32_s3_wroom
framework = arduino

; ============================================================================
; BOARD CONFIGURATION: Freenove ESP32-S3-WROOM with OPI PSRAM
; ============================================================================
; Hardware: ESP32-S3-WROOM (8MB Flash + 8MB OPI PSRAM)
; 
; Pin mapping:
;   GPIO 12 = PIN_PULSE (cable jaune)
;   GPIO 13 = PIN_DIR (cable orange)
;   GPIO 14 = PIN_ENABLE (cable rouge)
; ============================================================================

; change microcontroller
board_build.mcu = esp32s3

; change MCU frequency
board_build.f_cpu = 240000000L

; ============================================================================
; ESP32-S3-WROOM Configuration: 8MB Flash + 8MB PSRAM (OPI)
; Hardware: Freenove ESP32-S3-WROOM
; ============================================================================

; ============================================================================
; OTA (Over-The-Air) UPLOAD CONFIGURATION
; ============================================================================
; Default upload: OTA via WiFi
; To force USB upload: Comment out upload_protocol and uncomment esptool lines
; ============================================================================
upload_protocol = espota
upload_port = 192.168.1.81
upload_flags = 
    --port=3232
    --auth=REDACTED_OTA_PASSWORD

; USB upload settings (comment out upload_protocol above to use USB)
; upload_protocol = esptool
; upload_port = COM8

upload_speed = 921600
monitor_speed = 115200
monitor_filters = esp32_exception_decoder

; Flash configuration (8MB Flash + 8MB PSRAM OPI)
board_build.flash_mode = qio
board_build.flash_size = 8MB
board_build.memory_type = qio_opi
board_build.psram_type = opi

; Partition scheme for 8MB Flash with OTA support
; Options:
;   - default (1.3MB APP, 1.5MB SPIFFS)
;   - huge_app (3MB APP, no SPIFFS)
;   - min_spiffs (1.9MB APP, 190KB SPIFFS)
;   - no_ota (2MB APP, 2MB SPIFFS)
;   - default_8MB (3MB APP, 1.5MB SPIFFS) ‚Üê Supports OTA avec 2 partitions APP
board_build.partitions = default_8MB.csv

; ============================================================================
; FILESYSTEM CONFIGURATION (Phase 3.2 - LittleFS for HTML/CSS/JS)
; ============================================================================
; LittleFS will use the "spiffs" partition defined in default_8MB.csv (1.5MB)
; LittleFS is more modern than SPIFFS (wear-leveling, faster, supports directories)
board_build.filesystem = littlefs

; Build settings
build_flags = 
    ; Debug level (0=None, 1=Error, 2=Warn, 3=Info, 4=Debug, 5=Verbose)
    -D CORE_DEBUG_LEVEL=3
    
    ; PSRAM: Fully enabled (GPIO conflict resolved by moving motor pins)
    -D BOARD_HAS_PSRAM
    -D ARDUINO_ESP32S3_DEV
    
    ; NOTE: Watchdog timeout flags below are IGNORED (SDK is pre-compiled with qio_opi)
    ; Keeping them for documentation but they won't override SDK defaults
    ; -D CONFIG_ESP_TASK_WDT_TIMEOUT_S=10
    ; -D CONFIG_ESP_TASK_WDT_PANIC=1
    ; -D CONFIG_ESP_INT_WDT_TIMEOUT_MS=800
    
    ; Optimization flags
    -ffunction-sections          ; Place each function in its own section
    -fdata-sections              ; Place each data in its own section
    
    ; WiFi optimization
    -D CONFIG_LWIP_MAX_SOCKETS=16
    
    ; WebSocket buffer size (must be BEFORE library include)
    ; Default is 15KB but we set explicitly to avoid warning
    ; -DWEBSOCKETS_MAX_DATA_SIZE=8192
    
    ; ArduinoJson settings
    -D ARDUINOJSON_ENABLE_PROGMEM=1
    -D CONFIG_ARDUHAL_LOG_COLORS=1
    -D CORE_DEBUG_LEVEL=3
    -D ARDUINOJSON_USE_DOUBLE=0   ; Use float instead of double (save memory)

build_unflags =

; Libraries
lib_deps = 
    links2004/WebSockets@^2.7.1
    bblanchon/ArduinoJson@^7.4.2
