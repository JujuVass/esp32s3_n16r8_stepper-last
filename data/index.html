<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stepper Controller</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âš™ï¸</text></svg>">

  <!-- Note: Preloads removed - they cause issues with slow mDNS resolution -->
  <!-- Scripts are loaded sequentially at end of body for reliability -->

  <link rel="stylesheet" href="/css/styles.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
  <!-- Calibration Overlay -->
  <div class="overlay" id="calibrationOverlay">
    <div class="overlay-content">
      <div class="overlay-icon">ğŸ”</div>
      <div class="overlay-title">Calibration en cours...</div>
      <div class="overlay-message">Veuillez patienter pendant la recherche des limites</div>
      <div class="spinner"></div>
      <div style="color: #999; font-size: 14px; margin-top: 15px;">
        Ne pas interrompre le processus
      </div>
    </div>
  </div>

  <!-- Reboot Overlay -->
  <div class="overlay" id="rebootOverlay">
    <div class="overlay-content">
      <div class="overlay-icon">ğŸ”„</div>
      <div class="overlay-title">RedÃ©marrage en cours...</div>
      <div class="overlay-message" id="rebootMessage">Reconnexion automatique dans quelques secondes</div>
      <div class="spinner"></div>
      <div id="rebootStatus" style="color: #999; font-size: 14px; margin-top: 15px;">
        Veuillez patienter (~10-15 secondes)
      </div>
    </div>
  </div>

  <!-- Playlist Management Modal -->
  <div class="modal" id="playlistModal" onclick="closePlaylistModalOnOverlayClick(event)">
    <div class="modal-content" style="max-width: 650px; max-height: 85vh; display: flex; flex-direction: column;" onclick="event.stopPropagation()">
      <div class="modal-title">ğŸ“‹ Playlist - <span id="playlistModalTitle">Mode</span></div>
      
      <!-- Sticky Current Config Preview -->
      <div id="playlistCurrentConfig" style="background: #E3F2FD; padding: 12px; border-radius: 6px; margin-bottom: 12px; flex-shrink: 0;">
        <div style="font-weight: 500; margin-bottom: 8px; font-size: 13px;">âš™ï¸ Configuration actuelle:</div>
        <div id="playlistCurrentConfigContent" style="font-size: 12px; color: #555;"></div>
        <button class="button btn-success" id="btnAddCurrentToPlaylist" style="margin-top: 8px; width: 100%; padding: 8px; font-size: 13px;">
          â• Ajouter Ã  la playlist
        </button>
      </div>
      
      <!-- Presets List with Scroll -->
      <div style="flex: 1; overflow-y: auto; overflow-x: visible; border-top: 2px solid #ddd; padding-top: 12px; min-height: 0;">
        <div style="font-weight: 500; margin-bottom: 10px; font-size: 13px; padding: 0 5px;">
          ğŸ“¦ Presets sauvegardÃ©s (<span id="playlistCount">0</span>/20):
        </div>
        
        <!-- Search Input -->
        <input type="text" id="playlistSearchInput" placeholder="ğŸ” Rechercher un preset..." 
               oninput="filterPlaylistPresets(this.value)"
               style="width: 90%; margin: 0 0 10px 0; padding: 8px; border: 2px solid #ddd; border-radius: 6px; font-size: 12px;">
        
        <div id="playlistPresetsList" style="padding-right: 5px; overflow: visible;">
          <!-- Presets will be dynamically inserted here -->
          <div style="color: #999; font-style: italic; padding: 20px; text-align: center; font-size: 12px;">
            Aucun preset sauvegardÃ©
          </div>
        </div>
      </div>
      
      <!-- Sticky Close Button -->
      <div style="border-top: 2px solid #ddd; padding: 12px 0 0 0; margin-top: 12px; background: white; flex-shrink: 0;">
        <button class="button btn-secondary" onclick="closePlaylistModal()" style="width: 100%; padding: 10px; font-size: 14px;">
          âœ–ï¸ Fermer
        </button>
      </div>
    </div>
  </div>

  <!-- Playlist Tooltip Overlay -->
  <div id="playlistTooltipOverlay"></div>

  <!-- Mode Change Confirmation Modal -->
  <div class="modal" id="modeChangeModal">
    <div class="modal-content">
      <div class="modal-title">âš ï¸ Changement de mode</div>
      <div class="modal-message" id="modalMessage">
        Une opÃ©ration est en cours. Le changement de mode va arrÃªter le mouvement et lancer une recalibration.
        <br><br>
        <strong>Voulez-vous continuer ?</strong>
      </div>
      <div style="margin: 20px 0; padding: 15px; background: #FFF3E0; border-radius: 5px; border: 2px solid #FF9800;">
        <label style="display: flex; align-items: center; justify-content: center; cursor: pointer; font-weight: normal;">
          <input type="checkbox" id="bypassCalibrationCheckbox" checked style="margin-right: 10px; width: 18px; height: 18px; cursor: pointer;">
          <span style="color: #FF9800; font-weight: bold;">/!\ Bypasser la calibration complÃ¨te</span>
        </label>
        <div style="font-size: 12px; color: #666; margin-top: 8px; text-align: center;">
          (Retour rapide au contact dÃ©but uniquement)
        </div>
      </div>
      <div class="modal-buttons">
        <button class="button btn-danger" onclick="cancelModeChange()">Annuler</button>
        <button class="button btn-success" onclick="confirmModeChange()">Confirmer</button>
      </div>
    </div>
  </div>

  <!-- Stop Confirmation Modal -->
  <div class="modal" id="stopModal">
    <div class="modal-content">
      <div class="modal-title">â¹ï¸ ArrÃªter le mouvement</div>
      <div class="modal-message">
        Voulez-vous arrÃªter le mouvement en cours ?
      </div>
      <div style="margin: 20px 0; padding: 15px; background: #E3F2FD; border-radius: 5px; border: 2px solid #2196F3;">
        <label style="display: flex; align-items: center; justify-content: center; cursor: pointer; font-weight: normal;">
          <input type="checkbox" id="returnToStartCheckbox" checked style="margin-right: 10px; width: 18px; height: 18px; cursor: pointer;">
          <span style="color: #2196F3; font-weight: bold;">ğŸ  Retour Ã  la position initiale (0mm)</span>
        </label>
        <div style="font-size: 12px; color: #666; margin-top: 8px; text-align: center;">
          (DÃ©sactiver pour rester Ã  la position actuelle)
        </div>
      </div>
      <div class="modal-buttons">
        <button class="button btn-secondary" onclick="cancelStopModal()">Annuler</button>
        <button class="button btn-danger" onclick="confirmStopModal()">â¹ï¸ ArrÃªter</button>
      </div>
    </div>
  </div>

  <!-- Modal for Sequencer Limit Warning -->
  <div class="modal" id="sequencerLimitModal">
    <div class="modal-content">
      <div class="modal-title">âš ï¸ Passage en Mode SÃ©quenceur</div>
      <div class="modal-message">
        <div style="background: #E3F2FD; padding: 15px; border-radius: 8px; border-left: 4px solid #2196F3; margin-bottom: 15px;">
          <div style="font-weight: bold; color: #1976D2; margin-bottom: 8px;">ğŸ“‹ Mode Expert ActivÃ©</div>
          <div style="font-size: 14px; color: #555;">
            La limitation de course active sera <strong>DÃ‰SACTIVÃ‰E</strong> :
          </div>
        </div>
        
        <div style="display: grid; grid-template-columns: auto 1fr; gap: 10px; margin: 15px 0; padding: 15px; background: #FFF3E0; border-radius: 8px;">
          <div style="font-weight: bold; color: #FF9800;">â€¢ Actuel :</div>
          <div id="seqModalCurrentLimit" style="color: #FF9800; font-weight: bold;">--</div>
          <div style="font-weight: bold; color: #4CAF50;">â€¢ AprÃ¨s :</div>
          <div id="seqModalAfterLimit" style="color: #4CAF50; font-weight: bold;">--</div>
        </div>
        
        <div style="background: #F5F5F5; padding: 12px; border-radius: 8px; margin-bottom: 15px;">
          <div style="font-weight: bold; margin-bottom: 8px;">ğŸ”§ Raison :</div>
          <div style="font-size: 13px; color: #666; line-height: 1.5;">
            Le sÃ©quenceur peut contenir des lignes de calibration qui rÃ©initialisent cette limite.
          </div>
        </div>
        
        <div style="background: #E8F5E9; padding: 12px; border-radius: 8px; border-left: 4px solid #4CAF50;">
          <div style="font-weight: bold; color: #2E7D32; margin-bottom: 5px;">ğŸ’¡ En mode sÃ©quenceur :</div>
          <div style="font-size: 13px; color: #555;">
            Vous avez le <strong>contrÃ´le total</strong> des valeurs de chaque ligne.
          </div>
        </div>
        
        <div style="margin-top: 20px; text-align: center; font-weight: bold; color: #333;">
          Continuer ?
        </div>
      </div>
      <div class="modal-buttons">
        <button class="button btn-danger" onclick="cancelSequencerLimitChange()">Annuler</button>
        <button class="button btn-success" onclick="confirmSequencerLimitChange()">Confirmer</button>
      </div>
    </div>
  </div>

  <!-- Unified Alert Modal (replaces native alert()) -->
  <div class="modal" id="unifiedAlertModal">
    <div class="modal-content" style="max-width: 420px;">
      <div class="modal-title">
        <span id="unifiedAlertIcon" style="margin-right: 8px;">â„¹ï¸</span>
        <span id="unifiedAlertTitle">Information</span>
      </div>
      <div class="modal-message" id="unifiedAlertMessage" style="padding: 15px 0; line-height: 1.6;">
        Message
      </div>
      <div class="modal-buttons" style="justify-content: center;">
        <button class="button btn-primary" id="unifiedAlertOkBtn" onclick="closeAlertModal()" style="min-width: 120px;">OK</button>
      </div>
    </div>
  </div>

  <!-- Unified Confirm Modal (replaces native confirm()) -->
  <div class="modal" id="unifiedConfirmModal">
    <div class="modal-content" style="max-width: 450px;">
      <div class="modal-title">
        <span id="unifiedConfirmIcon" style="margin-right: 8px;">âš ï¸</span>
        <span id="unifiedConfirmTitle">Confirmation</span>
      </div>
      <div class="modal-message" id="unifiedConfirmMessage" style="padding: 15px 0; line-height: 1.6;">
        Message
      </div>
      <div class="modal-buttons">
        <button class="button btn-secondary" id="unifiedConfirmCancelBtn" onclick="closeConfirmModal(false)">Annuler</button>
        <button class="button btn-success" id="unifiedConfirmOkBtn" onclick="closeConfirmModal(true)">Confirmer</button>
      </div>
    </div>
  </div>

  <!-- WiFi Configuration Modal -->
  <div class="modal" id="wifiConfigModal">
    <div class="modal-content" style="max-width: 450px;">
      <div class="modal-title">ğŸ“¶ Configuration WiFi</div>
      
      <div style="padding: 15px 0;">
        <!-- Current EEPROM Config Display -->
        <div id="wifiCurrentConfig" style="background: #E3F2FD; padding: 12px; border-radius: 6px; margin-bottom: 15px; border-left: 4px solid #2196F3;">
          <div style="font-weight: 500; margin-bottom: 6px; font-size: 13px;">ğŸ“¦ Configuration actuelle en EEPROM:</div>
          <div id="wifiCurrentSsid" style="font-size: 12px; color: #555; font-family: monospace;">Chargement...</div>
        </div>
        
        <!-- Edit Form -->
        <div style="background: #f5f5f5; padding: 15px; border-radius: 6px;">
          <div style="margin-bottom: 12px;">
            <label style="display: block; font-weight: 500; margin-bottom: 5px; font-size: 13px;">SSID:</label>
            <input type="text" id="wifiEditSsid" placeholder="Nom du rÃ©seau WiFi" 
                   style="width: 100%; padding: 8px; border: 2px solid #ddd; border-radius: 4px; font-size: 13px; font-family: monospace;">
          </div>
          
          <div style="margin-bottom: 12px;">
            <label style="display: block; font-weight: 500; margin-bottom: 5px; font-size: 13px;">Mot de passe:</label>
            <input type="password" id="wifiEditPassword" placeholder="Mot de passe WiFi" 
                   style="width: 100%; padding: 8px; border: 2px solid #ddd; border-radius: 4px; font-size: 13px; font-family: monospace;">
            <label style="display: flex; align-items: center; margin-top: 5px; cursor: pointer; font-size: 12px; color: #666;">
              <input type="checkbox" id="wifiShowPassword" style="margin-right: 5px;">
              Afficher le mot de passe
            </label>
          </div>
          
          <div id="wifiEditStatus" style="padding: 8px; border-radius: 4px; margin-top: 10px; font-size: 12px; display: none;"></div>
        </div>
      </div>
      
      <div class="modal-buttons">
        <button class="button btn-secondary" onclick="closeWifiConfigModal()">âœ–ï¸ Annuler</button>
        <button class="button btn-success" id="btnSaveWifiConfig">ğŸ’¾ Enregistrer</button>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Common Status (COMPACT VERSION) -->
    <div class="status-compact" style="background:white; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.1); margin-bottom:15px; overflow:hidden;">
      
      <!-- Header Row: Ã‰tat + Actions -->
      <div style="display:flex; justify-content:space-between; align-items:center; padding:8px 15px; background:#E3F2FD; border-bottom:1px solid #BBDEFB;">
        <span style="font-weight:bold; font-size:15px; color:#1976D2;">
          Ã‰tat: <span id="state" style="color:#333;">Initialisation...</span>
        </span>
        <div style="display:flex; gap:6px;">
          <button class="btn-compact btn-primary" id="btnCalibrateCommon" title="Calibrer les limites">ğŸ” Calib</button>
          <button class="btn-compact btn-info" id="btnShowLogs" title="Afficher logs">ğŸ“‹ Logs</button>
          
          <button class="btn-compact btn-success" id="btnShowStats" title="Afficher statistiques">ğŸ“Š Stats</button>
          <button class="btn-compact" id="btnShowSystem" title="Afficher statistiques systÃ¨me" style="background: #2196F3; color: white;">âš™ï¸ Sys</button>
        </div>
      </div>
      
      <!-- Row 2: Position + Course -->
      <div style="padding:6px 15px; font-size:13px; border-bottom:1px solid #f0f0f0;">
        ğŸ“ <strong>Position:</strong> <span id="position">0.0 mm (0 steps)</span>
        &nbsp;&nbsp;â€¢&nbsp;&nbsp;
        <strong>Course:</strong> <span id="totalDist">-- mm</span>
        <button id="btnConfigMaxDist" class="btn-icon" title="Limiter course" style="padding:2px 6px; font-size:13px; background:transparent; border:1px solid #ddd; border-radius:3px; cursor:pointer; margin-left:4px;">âš™ï¸</button>
      </div>
      
      <!-- Max Distance Config Panel (collapsible) -->
      <div id="maxDistConfigPanel" style="display:none; padding:10px 15px; background:#FFF3E0; border-bottom:1px solid #FFE0B2;">
        <div style="font-weight:bold; color:#FF9800; margin-bottom:6px; font-size:12px;">âš™ï¸ Limitation de course</div>
        <div style="font-size:11px; color:#666; margin-bottom:8px;">
          â„¹ï¸ Limite la zone utilisable sans recalibrer
        </div>
        <div style="display:flex; align-items:center; gap:8px; margin-bottom:6px;">
          <span style="font-size:11px; font-weight:bold; min-width:45px;">Limite:</span>
          <input type="range" id="maxDistLimitSlider" min="50" max="100" value="100" step="1" style="flex:1; height:6px;" disabled>
          <span id="maxDistLimitValue" style="font-weight:bold; font-size:12px; min-width:40px;">100%</span>
          <span id="maxDistLimitMM" style="color:#666; font-size:11px; min-width:70px;">(-- mm)</span>
        </div>
        <div style="display:flex; gap:6px;">
          <button id="btnApplyMaxDistLimit" class="btn-compact btn-success" disabled>âœ… OK</button>
          <button id="btnCancelMaxDistLimit" class="btn-compact btn-secondary">âœ• Annuler</button>
        </div>
        <div style="font-size:10px; color:#d32f2f; margin-top:6px; display:none;" id="maxDistLimitWarning">
          âš ï¸ Modification en Ã©tat PRÃŠT uniquement
        </div>
      </div>
      
      <!-- Row 3: Vitesses -->
      <div style="padding:6px 15px; font-size:13px; border-bottom:1px solid #f0f0f0;">
        âš¡ <strong>Vitesse:</strong> <span id="currentSpeed">â†—ï¸ --  â€¢  â†™ï¸ --</span>
        <span style="color:#999; font-size:11px; margin-left:8px;">(-- c/min)</span>
      </div>
      
      <!-- Row 4: Distance + Progress Bar (colonnes fixes) -->
      <div style="padding:6px 15px; font-size:13px; display:grid; grid-template-columns: 280px 1fr 50px; gap:10px; align-items:center; border-bottom:1px solid #f0f0f0;">
        <div style="white-space:nowrap;">
          ğŸ“Š <strong>Distance:</strong> <span id="statsRecordingWarning" style="display: none; color: #FF9800; cursor: help; margin-left: 4px;" title="âš ï¸ Enregistrement des stats dÃ©sactivÃ©">âš ï¸</span> <span id="milestoneIcon" style="font-size: 20px; margin-left: 8px; cursor: help; display: inline-block; transition: transform 0.3s;" title=""></span> <span id="totalTraveled">0.000 m</span> <button class="btn-icon" id="btnResetDistanceCommon" title="RÃ©initialiser distance" style="padding:2px 6px; font-size:13px; background:transparent; border:1px solid #ddd; border-radius:3px; cursor:pointer; margin-left:4px;">â†»</button>
          
        </div>
        <div style="height:8px; background:#e0e0e0; border-radius:4px; overflow:hidden;">
          <div id="progressMini" style="width:0%; height:100%; background:linear-gradient(90deg,#2196F3,#21CBF3); transition:width 0.3s;"></div>
        </div>
        <span id="progressPct" style="font-weight:bold; font-size:12px; text-align:right;">0.0%</span>
      </div>
      
      <!-- Pending Changes Alert (conditional) -->
      <div id="pendingChanges" style="display:none; padding:6px 15px; background:#FFF3E0; color:#FF9800; font-weight:bold; font-size:12px; border-bottom:1px solid #FFE0B2;">
        â³ Changements en attente (fin de cycle)
      </div>
      
    </div>

    <!-- Logs Panel (hidden by default) -->
    <div id="logsPanel" style="display: none; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 15px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; border-bottom: 2px solid #2196F3; padding-bottom: 8px;">
        <h3 style="margin: 0; color: #2196F3; font-size: 18px;">ğŸ“‹ Logs & Debug</h3>
        <button id="btnCloseLogs" style="background: #f44336; color: white; border: none; padding: 4px 10px; border-radius: 5px; cursor: pointer; font-size: 14px;">âœ•</button>
      </div>

      <!-- Log Console -->
      <div class="mb-12">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
          <label style="font-weight: bold; color: #333; font-size: 13px;">Console temps rÃ©el:</label>
          <div style="display: flex; gap: 6px;">
            <button class="button btn-secondary" id="btnClearLogsPanel" style="padding: 4px 10px; font-size: 11px;">ğŸ—‘ï¸ Effacer</button>
          </div>
        </div>
        <div id="logConsolePanel" style="height: 180px; overflow: auto; background: #1e1e1e; color: #d4d4d4; padding: 8px; border-radius: 4px; font-family: 'Courier New', monospace; font-size: 11px; white-space: pre-wrap; border: 1px solid #333;">(les logs apparaÃ®tront ici...)</div>
      </div>

      <!-- Debug Controls -->
      <div style="background: #f5f5f5; padding: 10px; border-radius: 6px; margin-bottom: 12px;">
        <label style="font-weight: bold; color: #333; display: block; margin-bottom: 8px; font-size: 13px;">âš™ï¸ Niveau de debug:</label>
        <div style="display: flex; gap: 8px; align-items: center;">
          <label style="display: flex; align-items: center; cursor: pointer;">
            <input type="checkbox" id="debugLevelCheckbox" style="width: 16px; height: 16px; margin-right: 6px;">
            <span class="text-md">Activer logs DEBUG (verbose)</span>
          </label>
          <span style="color: #666; font-size: 11px; margin-left: auto;">âš ï¸ Peut ralentir</span>
        </div>
      </div>

      <!-- Historical Logs -->
      <div style="background: #fff3cd; padding: 10px; border-radius: 6px; border-left: 4px solid #ffc107;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
          <label style="font-weight: bold; color: #856404; font-size: 13px;">ğŸ“š Historique des logs:</label>
          <button class="button btn-danger" id="btnClearAllLogFiles" style="padding: 4px 10px; font-size: 11px;">ğŸ—‘ï¸ Nettoyer tout</button>
        </div>
        <div id="logFilesList" style="max-height: 130px; overflow-y: auto; background: white; padding: 8px; border-radius: 4px; border: 1px solid #ddd;">
          <div style="color: #999; font-style: italic; font-size: 11px;">Chargement de la liste...</div>
        </div>
      </div>
    </div>

    <!-- Statistics Panel -->
    <div id="statsPanel" style="display: none; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 15px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; border-bottom: 2px solid #4CAF50; padding-bottom: 8px;">
        <h3 style="margin: 0; color: #4CAF50; font-size: 18px;">
          ğŸ“Š Statistiques
        </h3>
        <button id="btnCloseStats" style="background: #f44336; color: white; border: none; padding: 4px 10px; border-radius: 5px; cursor: pointer; font-size: 14px;">âœ•</button>
      </div>

      <!-- Stats Table -->
      <div style="margin-bottom: 20px; overflow-x: auto; max-height: 300px; overflow-y: auto; border: 1px solid #ddd; border-radius: 6px;">
        <table id="statsTable" style="width: 100%; border-collapse: collapse; font-size: 13px;">
          <thead style="position: sticky; top: 0; background: #f5f5f5; z-index: 1;">
            <tr style="border-bottom: 2px solid #4CAF50;">
              <th style="padding: 8px; text-align: left; font-weight: bold;">Date</th>
              <th style="padding: 8px; text-align: center; font-weight: bold;">Jour</th>
              <th style="padding: 8px; text-align: center; font-weight: bold;">ğŸ†</th>
              <th style="padding: 8px; text-align: right; font-weight: bold;">Distance</th>
            </tr>
          </thead>
          <tbody id="statsTableBody">
            <tr>
              <td colspan="4" style="padding: 20px; text-align: center; color: #999; font-style: italic;">Aucune statistique disponible</td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <!-- Stats Footer (outside scroll container) -->
      <div style="background: #e8f5e9; border: 2px solid #4CAF50; border-radius: 6px; padding: 10px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; font-weight: bold;">
        <span>TOTAL</span>
        <span>ğŸ†</span>
        <span id="statsTotalMilestone" style="font-size: 18px;">ğŸ¯</span>
        <span id="statsTotalDistance" style="color: #4CAF50; font-size: 15px;">0 km</span>
      </div>

      <!-- Stats Action Buttons -->
      <div style="margin-bottom: 20px; text-align: center; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; align-items: center;">
        <button id="btnExportStats" class="button" style="padding: 8px 20px; font-size: 13px; background: #4CAF50; color: white;">
          ğŸ“¥ Exporter
        </button>
        <button id="btnImportStats" class="button" style="padding: 8px 20px; font-size: 13px; background: #2196F3; color: white;">
          ğŸ“¤ Importer
        </button>
        <button id="btnClearStats" class="button btn-danger" style="padding: 8px 20px; font-size: 13px;">
          ğŸ—‘ï¸ Effacer tout
        </button>
        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; padding: 8px 12px; background: #f5f5f5; border-radius: 5px; border: 1px solid #ddd;" title="DÃ©sactiver pour ignorer les enregistrements des stats">
          <input type="checkbox" id="statsRecordingEnabled" checked style="width: 16px; height: 16px; cursor: pointer;">
          <span style="font-size: 12px; color: #666;">Activer sauvegarde</span>
        </label>
      </div>
      
      <!-- Hidden file input for import -->
      <input type="file" id="statsFileInput" accept=".json" class="hidden">

      <!-- Histogram -->
      <div style="background: #f9f9f9; padding: 12px; border-radius: 6px; border: 1px solid #ddd;">
        <h4 style="margin: 0 0 12px 0; color: #333; font-size: 14px;">ğŸ“ˆ Historique (3 mois glissants)</h4>
        <canvas id="statsChart" style="max-height: 250px;"></canvas>
      </div>
    </div>

    <!-- System Stats Panel (hidden by default like Stats panel) -->
    <div id="systemPanel" style="display: none; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 15px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; border-bottom: 2px solid #2196F3; padding-bottom: 8px;">
        <h3 style="margin: 0; color: #2196F3; font-size: 18px;">âš™ï¸ SystÃ¨me</h3>
        <button id="btnCloseSystem" style="background: #f44336; color: white; border: none; padding: 4px 10px; border-radius: 5px; cursor: pointer; font-size: 14px;">âœ•</button>
      </div>

      <!-- System Stats Grid -->
      <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; font-size: 13px;">
        <div style="background: #f5f5f5; padding: 10px; border-radius: 6px;">
          <div style="color: #666; font-size: 11px; margin-bottom: 4px;">CPU</div>
          <div id="sysCpuFreq" class="value-display">-- MHz</div>
        </div>
        
        <div style="background: #f5f5f5; padding: 10px; border-radius: 6px;">
          <div style="color: #666; font-size: 11px; margin-bottom: 4px;">ğŸŒ¡ï¸ TempÃ©rature</div>
          <div id="sysTemp" class="value-display">-- Â°C</div>
        </div>
        
        <div style="background: #f5f5f5; padding: 10px; border-radius: 6px;">
          <div style="color: #666; font-size: 11px; margin-bottom: 4px;">ğŸ’¾ RAM</div>
          <div id="sysRam" class="value-display">-- KB libre</div>
          <div id="sysRamPercent" style="font-size: 11px; color: #666; margin-top: 2px;">--% utilisÃ©</div>
        </div>
        
        <div style="background: #f5f5f5; padding: 10px; border-radius: 6px;">
          <div style="color: #666; font-size: 11px; margin-bottom: 4px;">ğŸ§  PSRAM</div>
          <div id="sysPsram" class="value-display">-- MB libre</div>
          <div id="sysPsramPercent" style="font-size: 11px; color: #666; margin-top: 2px;">--% utilisÃ©</div>
        </div>
        
        <div style="background: #f5f5f5; padding: 10px; border-radius: 6px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
            <div style="color: #666; font-size: 11px;">ğŸ“¶ WiFi</div>
            <div style="display: flex; gap: 4px;">
              <button id="btnEditWifi" style="background: #FF9800; color: white; border: none; padding: 3px 8px; border-radius: 4px; cursor: pointer; font-size: 10px;" title="Ã‰diter la config WiFi">
                âœï¸
              </button>
              <button id="btnRefreshWifi" style="background: #2196F3; color: white; border: none; padding: 3px 8px; border-radius: 4px; cursor: pointer; font-size: 10px;" title="Reconnecter le WiFi">
                ğŸ”„
              </button>
            </div>
          </div>
          <div id="sysWifi" class="value-display">-- dBm</div>
          <div id="sysWifiQuality" style="font-size: 11px; color: #666; margin-top: 2px;">--</div>
        </div>
        
        <div style="background: #f5f5f5; padding: 10px; border-radius: 6px;">
          <div style="color: #666; font-size: 11px; margin-bottom: 4px;">âš¡ Uptime</div>
          <div id="sysUptime" class="value-display">--</div>
        </div>
      </div>

      <!-- Network Info Section -->
      <div id="networkInfoSection" style="margin-top: 15px; background: #e3f2fd; padding: 12px; border-radius: 6px; border-left: 4px solid #2196F3;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
          <div style="font-weight: bold; color: #1976D2; font-size: 13px;">ğŸŒ RÃ©seau</div>
          <div id="sysDegradedBadge" style="display: none; background: #FF9800; color: white; padding: 2px 8px; border-radius: 10px; font-size: 10px; font-weight: bold;">âš ï¸ MODE DÃ‰GRADÃ‰</div>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 12px;">
          <div>
            <div style="color: #666; font-size: 10px;">IP STA (WiFi)</div>
            <div id="sysIpSta" style="font-weight: bold; color: #333; font-family: monospace;">--</div>
          </div>
          <div>
            <div style="color: #666; font-size: 10px;">IP AP (Point d'accÃ¨s)</div>
            <div id="sysIpAp" style="font-weight: bold; color: #333; font-family: monospace;">--</div>
          </div>
          <div>
            <div style="color: #666; font-size: 10px;">Hostname (mDNS)</div>
            <div id="sysHostname" style="font-weight: bold; color: #2196F3; font-family: monospace;">--</div>
          </div>
          <div>
            <div style="color: #666; font-size: 10px;">SSID connectÃ©</div>
            <div id="sysSsid" style="font-weight: bold; color: #333;">--</div>
          </div>
          <div style="grid-column: span 2;">
            <div style="color: #666; font-size: 10px;">ğŸ“¡ Clients AP connectÃ©s</div>
            <div id="sysApClients" style="font-weight: bold; color: #4CAF50;">0</div>
          </div>
        </div>
      </div>

      <!-- Logging Configuration -->
      <div style="margin-top: 15px; background: #f5f5f5; padding: 12px; border-radius: 6px;">
        <div style="font-weight: bold; color: #333; font-size: 13px; margin-bottom: 10px;">ğŸ“‹ Configuration des logs</div>
        
        <!-- Enable/Disable Logging -->
        <div class="mb-10">
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; user-select: none;">
            <input type="checkbox" id="chkLoggingEnabled" checked style="width: 18px; height: 18px; cursor: pointer;">
            <span style="font-size: 13px; color: #333;">Activer les logs (console + fichiers)</span>
          </label>
          <div style="font-size: 11px; color: #666; margin-left: 26px; margin-top: 4px;">
            âš ï¸ DÃ©sactiver rÃ©duit l'utilisation CPU mais supprime tous les logs
          </div>
        </div>
        
        <!-- Debug Level Toggle -->
        <div style="margin-bottom: 4px;">
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; user-select: none;">
            <input type="checkbox" id="chkDebugLevel" style="width: 18px; height: 18px; cursor: pointer;">
            <span style="font-size: 13px; color: #333;">Activer logs DEBUG (verbose)</span>
          </label>
          <div style="font-size: 11px; color: #666; margin-left: 26px; margin-top: 4px;">
            â„¹ï¸ Niveau INFO (messages normaux) par dÃ©faut
          </div>
        </div>
      </div>

      <!-- Reboot Button Only -->
      <div style="margin-top: 15px; display: flex; gap: 10px;">
        <button id="btnReboot" class="button btn-danger" style="flex: 1; padding: 12px; font-size: 14px; font-weight: bold;">
          ğŸ”„ RedÃ©marrer
        </button>
      </div>
    </div>

    <!-- Welcome message (shown before first calibration) -->
    <div class="welcome-message" id="welcomeMessage">
      <h2>ğŸ‘‹ Bienvenue!</h2>
      <p>ğŸ”§ Avant de commencer, veuillez effectuer une calibration pour dÃ©tecter les limites de course.</p>
      <p>ğŸ‘† Cliquez sur le bouton <strong>"ğŸ” Calibrer"</strong> dans la section "Outils communs" ci-dessus.</p>
      <p style="font-size: 14px; opacity: 0.8; margin-top: 20px;">
        âš™ï¸ Les modes de contrÃ´le apparaÃ®tront automatiquement aprÃ¨s la calibration.
      </p>
    </div>

    <!-- Tabs Navigation (after status) -->
    <div class="tabs hidden-until-calibrated" id="tabsContainer">
      <button class="tab active" data-tab="simple">ğŸ”„ Simple</button>
      <button class="tab" data-tab="pursuit">ğŸ¯ Poursuite</button>
      <button class="tab" data-tab="oscillation">ã€°ï¸ Oscillation</button>
      <button class="tab" data-tab="chaos">ğŸ² Chaos</button>
      <button class="tab" data-tab="tableau">ğŸ“‹ SÃ©quenceur</button>
    </div>

    <!-- MODE SIMPLE Tab Content -->
    <div class="tab-content active hidden-until-calibrated" id="tabSimple">
      <div class="controls">
        
      <!-- Position/Distance - 2-Column Grid -->
      <div class="form-row-compact">
        <div class="form-group-compact d-block">
          <div>
            <label class="label-inline">Position dÃ©part:</label>
            <input type="number" id="startPosition" min="0" step="0.1" value="0" class="input-compact">
            <span class="unit-label">mm</span>
          </div>
          <div class="mt-8">
            <button class="preset-btn-sm btn-preset" data-start="0">0mm</button>
            <button class="preset-btn-sm btn-preset" data-start="25">25mm</button>
            <button class="preset-btn-sm btn-preset" data-start="50">50mm</button>
            <button class="preset-btn-sm btn-preset" data-start="75">75mm</button>
            <button class="preset-btn-sm btn-preset" data-start="100">100mm</button>
          </div>
        </div>
        
        <div class="form-group-compact d-block">
          <div>
            <label class="label-inline">Distance:</label>
            <input type="number" id="distance" min="0" step="0.1" value="50" class="input-compact">
            <span class="unit-label">mm</span>
          </div>
          <div class="mt-8">
            <button class="preset-btn-sm btn-preset" data-distance="25">25mm</button>
            <button class="preset-btn-sm btn-preset" data-distance="50">50mm</button>
            <button class="preset-btn-sm btn-preset" data-distance="75">75mm</button>
            <button class="preset-btn-sm btn-preset" data-distance="100">100mm</button>
            <button class="preset-btn-sm btn-preset" data-distance="125">125mm</button>
          </div>
        </div>
      </div>
      
      <!-- SÃ©parateur -->
      <div class="divider"></div>
      
      <!-- Speed Mode Toggle - Radio Buttons -->
      <div class="form-group-compact" style="margin-bottom: 15px;">
        <label class="label-inline">âš™ï¸ Vitesse:</label>
        <div class="radio-inline">
          <label>
            <input type="radio" name="speedMode" id="speedModeUnified" checked>
            UnifiÃ©e
          </label>
          <label>
            <input type="radio" name="speedMode" id="speedModeSeparate">
            SÃ©parÃ©e
          </label>
        </div>
      </div>
      
      <!-- Unified Speed - Single Line -->
      <div id="speedUnifiedGroup" class="speed-control-inline mb-12">
        <label class="label-inline">Vitesse:</label>
        <input type="number" id="speedUnified" min="0" max="20" step="0.1" value="5" class="input-compact">
        <button class="preset-btn-sm btn-preset" data-speed-unified="0.5" title="Ultra lent">0.5 ğŸŒ</button>
        <button class="preset-btn-sm btn-preset" data-speed-unified="1" title="TrÃ¨s lent">1</button>
        <button class="preset-btn-sm btn-preset" data-speed-unified="2">2</button>
        <button class="preset-btn-sm btn-preset" data-speed-unified="3">3</button>
        <button class="preset-btn-sm btn-preset active" data-speed-unified="5" title="Normal">5 âœ“</button>
        <button class="preset-btn-sm btn-preset" data-speed-unified="10">10</button>
        <button class="preset-btn-sm btn-preset" data-speed-unified="15">15</button>
        <button class="preset-btn-sm btn-preset" data-speed-unified="20" title="Maximum">20 âš¡</button>
      </div>
      
      <!-- Separate Speeds - Stacked -->
      <div id="speedSeparateGroup" style="display: none; margin-bottom: 12px;">
        <div class="speed-control-inline" style="margin-bottom: 8px;">
          <label class="label-inline">Aller:</label>
          <input type="number" id="speedForward" min="0" max="20" step="0.1" value="5" class="input-compact">
          <button class="preset-btn-sm btn-preset" data-speed-forward="0.5">0.5 ğŸŒ</button>
          <button class="preset-btn-sm btn-preset" data-speed-forward="1">1</button>
          <button class="preset-btn-sm btn-preset" data-speed-forward="2">2</button>
          <button class="preset-btn-sm btn-preset" data-speed-forward="3">3</button>
          <button class="preset-btn-sm btn-preset active" data-speed-forward="5">5 âœ“</button>
          <button class="preset-btn-sm btn-preset" data-speed-forward="10">10</button>
          <button class="preset-btn-sm btn-preset" data-speed-forward="15">15</button>
          <button class="preset-btn-sm btn-preset" data-speed-forward="20">20 âš¡</button>
        </div>
        <div class="speed-control-inline">
          <label class="label-inline">Retour:</label>
          <input type="number" id="speedBackward" min="0" max="20" step="0.1" value="5" class="input-compact">
          <button class="preset-btn-sm btn-preset" data-speed-backward="0.5">0.5 ğŸŒ</button>
          <button class="preset-btn-sm btn-preset" data-speed-backward="1">1</button>
          <button class="preset-btn-sm btn-preset" data-speed-backward="2">2</button>
          <button class="preset-btn-sm btn-preset" data-speed-backward="3">3</button>
          <button class="preset-btn-sm btn-preset active" data-speed-backward="5">5 âœ“</button>
          <button class="preset-btn-sm btn-preset" data-speed-backward="10">10</button>
          <button class="preset-btn-sm btn-preset" data-speed-backward="15">15</button>
          <button class="preset-btn-sm btn-preset" data-speed-backward="20">20 âš¡</button>
        </div>
      </div>

      <!-- SÃ©parateur -->
      <div class="divider"></div>

      <!-- Deceleration - Collapsible Section -->
      <div class="section-collapsible collapsed" id="decelSection">
        <div class="section-collapsible-header" onclick="toggleDecelSection()">
          <span class="collapse-icon">â–¼</span> <span id="decelHeaderText">ğŸ¯ DÃ©cÃ©lÃ©ration - dÃ©sactivÃ©e</span>
        </div>
        
        <div class="section-collapsible-content">
          <!-- Zone -->
          <div class="speed-control-inline mb-10">
            <label class="label-inline">Zone:</label>
            <input type="number" id="decelZoneMM" min="10" max="200" step="5" value="50" class="input-compact">
            <span class="unit-label">mm</span>
            <button class="preset-btn-sm btn-preset" data-decel-zone="10">10</button>
            <button class="preset-btn-sm btn-preset" data-decel-zone="25">25</button>
            <button class="preset-btn-sm btn-preset active" data-decel-zone="50">50</button>
            <button class="preset-btn-sm btn-preset" data-decel-zone="75">75</button>
          </div>
          
          <!-- Mode, Effect, DÃ©but/Fin - All on one line -->
          <div class="speed-control-inline mb-10">
            <label class="label-inline">Mode:</label>
            <select id="decelModeSelect" style="width: 120px; padding: 6px; font-size: 13px; border: 1px solid #ddd; border-radius: 4px;">
              <option value="0">LinÃ©aire</option>
              <option value="1" selected>SinusoÃ¯dal</option>
              <option value="2">Triangle Inv.</option>
              <option value="3">Sinus Inv.</option>
            </select>
            
            <span style="margin-left: 10px; font-size: 13px; font-weight: 500;">Effet:</span>
            <input type="range" id="decelEffectPercent" min="0" max="100" step="5" value="75" style="width: 100px;">
            <span id="effectValue" style="font-weight: bold; min-width: 35px; font-size: 13px;">75%</span>
            
            <span style="margin-left: 10px; font-size: 13px;">-</span>
            <label style="margin-left: 5px; font-size: 13px;">
              <input type="checkbox" id="decelZoneStart" checked style="margin-right: 3px;">
              DÃ©but
            </label>
            <label style="margin-left: 10px; font-size: 13px;">
              <input type="checkbox" id="decelZoneEnd" checked style="margin-right: 3px;">
              Fin
            </label>
          </div>
          
          <!-- Canvas Preview -->
          <canvas id="decelPreview" class="canvas-compact" width="300" height="100"></canvas>
        </div>
      </div>

      <!-- ===== CYCLE PAUSE SECTION ===== -->
      <div class="section-collapsible collapsed" style="margin-bottom: 20px;">
        <div class="section-collapsible-header" onclick="toggleCyclePauseSection()">
          <span class="collapse-icon">â–¼</span> <span id="cyclePauseHeaderText">â¸ï¸ Pause entre cycles - dÃ©sactivÃ©e</span>
        </div>
        
        <div class="section-collapsible-content">
          <!-- Mode Selection: Fixed / Random -->
          <div class="speed-control-inline" style="margin-bottom: 15px;">
            <label class="label-inline">Mode:</label>
            <label style="margin-right: 15px; font-size: 13px;">
              <input type="radio" name="cyclePauseMode" value="fixed" id="pauseModeFixed" checked style="margin-right: 5px;">
              â±ï¸ Fixe
            </label>
            <label style="font-size: 13px;">
              <input type="radio" name="cyclePauseMode" value="random" id="pauseModeRandom" style="margin-right: 5px;">
              ğŸ² AlÃ©atoire
            </label>
          </div>
          
          <!-- Fixed Mode: Single Duration -->
          <div id="pauseFixedControls" class="speed-control-inline mb-10">
            <label class="label-inline">DurÃ©e:</label>
            <input type="number" id="cyclePauseDuration" min="0.1" max="60" step="0.1" value="1.5" class="input-compact">
            <span class="unit-label">s</span>
            <button class="preset-btn-sm btn-preset" data-pause-duration="0.5">0.5s</button>
            <button class="preset-btn-sm btn-preset active" data-pause-duration="1.5">1.5s</button>
            <button class="preset-btn-sm btn-preset" data-pause-duration="3">3s</button>
            <button class="preset-btn-sm btn-preset" data-pause-duration="5">5s</button>
            <button class="preset-btn-sm btn-preset" data-pause-duration="10">10s</button>
          </div>
          
          <!-- Random Mode: Min/Max Range -->
          <div id="pauseRandomControls" class="hidden">
            <div class="speed-control-inline mb-10">
              <label class="label-inline">Min:</label>
              <input type="number" id="cyclePauseMin" min="0.1" max="60" step="0.1" value="1.5" class="input-compact">
              <span class="unit-label">s</span>
              <button class="preset-btn-sm btn-preset" data-pause-min="0.5">0.5s</button>
              <button class="preset-btn-sm btn-preset active" data-pause-min="1.5">1.5s</button>
              <button class="preset-btn-sm btn-preset" data-pause-min="3">3s</button>
            </div>
            
            <div class="speed-control-inline mb-10">
              <label class="label-inline">Max:</label>
              <input type="number" id="cyclePauseMax" min="0.1" max="60" step="0.1" value="5.0" class="input-compact">
              <span class="unit-label">s</span>
              <button class="preset-btn-sm btn-preset" data-pause-max="3">3s</button>
              <button class="preset-btn-sm btn-preset active" data-pause-max="5">5s</button>
              <button class="preset-btn-sm btn-preset" data-pause-max="10">10s</button>
              <button class="preset-btn-sm btn-preset" data-pause-max="15">15s</button>
            </div>
          </div>
          
          <!-- Real-time Pause Indicator -->
          <div id="cyclePauseStatus" style="margin-top: 10px; padding: 8px; background: #f0f0f0; border-radius: 5px; font-size: 13px; text-align: center; display: none;">
            <strong>â±ï¸ En pause:</strong> <span id="cyclePauseRemaining">0.0s</span> restantes
          </div>
        </div>
      </div>

    <div class="button-group">
      <button class="button btn-success" id="btnStart">â–¶ DÃ©marrer</button>
      <button class="button btn-warning" id="btnPause">â¸ Pause</button>
      <button class="button btn-danger" id="btnStop">â¹ ArrÃªter</button>
      <button class="button btn-info" id="btnManagePlaylistSimple">
        ğŸ“‹ Playlist (0/20)
      </button>
    </div>
    

    </div>
    </div>
    <!-- END MODE SIMPLE -->

    <!-- MODE POURSUITE Tab Content -->
    <div class="tab-content hidden-until-calibrated" id="tabPursuit">
      <div class="controls">
        
        <!-- Pursuit Controls -->
        <div style="display: flex; gap: 30px; align-items: flex-start; margin-bottom: 20px;">
          
          <!-- Left Side: Gauge -->
          <div style="flex: 0 0 200px;">
            <div style="text-align: center; margin-bottom: 10px;">
              <strong style="color: #333;">Jauge de Position</strong>
            </div>
            
            <!-- Gauge Container -->
            <div id="gaugeContainer" style="position: relative; width: 120px; height: 500px; margin: 0 auto; background: linear-gradient(180deg, #f44336 0%, #FF9800 20%, #FFC107 40%, #4CAF50 60%, #2196F3 80%, #9C27B0 100%); border: 3px solid #333; border-radius: 10px; cursor: crosshair; box-shadow: 0 4px 10px rgba(0,0,0,0.2);">
              
              <!-- Target Cursor (user control) -->
              <div id="gaugeCursor" style="position: absolute; left: -5px; right: -5px; height: 8px; background: #FF5722; border: 3px solid white; border-radius: 4px; cursor: grab; box-shadow: 0 2px 8px rgba(0,0,0,0.5); transition: top 0.05s linear; z-index: 10;">
                <div style="position: absolute; right: -60px; top: -8px; background: #FF5722; color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; white-space: nowrap;">
                  CIBLE
                </div>
              </div>
              
              <!-- Current Position Indicator -->
              <div id="gaugePosition" style="position: absolute; left: 0; right: 0; height: 6px; background: #00E676; border: 2px solid white; border-radius: 3px; box-shadow: 0 2px 8px rgba(0,255,118,0.6); transition: top 0.1s linear; z-index: 5;">
                <div style="position: absolute; left: -60px; top: -8px; background: #00E676; color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; white-space: nowrap;">
                  RÃ‰EL
                </div>
              </div>
              
              <!-- Software Limit Line (dynamically positioned if limit < 100%) -->
              <div id="gaugeLimitLine" style="position: absolute; left: -8px; right: -8px; height: 3px; background: #000; border-top: 2px dashed #FF5722; display: none; z-index: 15;">
                <div style="position: absolute; right: -90px; top: -10px; background: #000; color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px; font-weight: bold; white-space: nowrap;">
                  ğŸš« LIMITE
                </div>
              </div>
              
              <!-- Scale markers -->
              <div style="position: absolute; right: -40px; top: 0; height: 100%; display: flex; flex-direction: column; justify-content: space-between; font-size: 11px; color: #666;">
                <span>FIN â–¶</span>
                <span>75% â–¶</span>
                <span>50% â–¶</span>
                <span>25% â–¶</span>
                <span>0mm â–¶</span>
              </div>
            </div>
            
            <div style="text-align: center; margin-top: 15px; font-size: 12px; color: #666;">
              <div><strong>Cible:</strong> <span id="targetPositionMM" style="color: #FF5722;">0.0</span> mm</div>
              <div><strong>Actuel:</strong> <span id="currentPositionMM" style="color: #00E676;">0.0</span> mm</div>
              <div><strong>Ã‰cart:</strong> <span id="positionError" class="text-muted">0.0</span> mm</div>
            </div>
          </div>
          
          <!-- Right Side: Settings -->
          <div style="flex: 1;">
            <!-- Checkbox Activer - COMPACT -->
            <div style="padding: 10px 15px; background: #E3F2FD; border-radius: 6px; margin-bottom: 15px;">
              <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                <input type="checkbox" id="pursuitActiveCheckbox" autocomplete="off">
                <span style="font-weight: 500; color: #1976D2;">ğŸ¯ Activer poursuite</span>
              </label>
              <small style="color: #666; display: block; margin-top: 4px; font-size: 11px; padding-left: 28px;">
                âš ï¸ Le moteur suivra automatiquement le curseur
              </small>
            </div>
            
            <!-- Vitesse max - COMPACT -->
            <div class="form-group-compact d-block">
              <div>
                <label class="label-inline">Vitesse max:</label>
                <input type="number" id="pursuitMaxSpeed" min="0.5" max="20" step="0.5" value="10" class="input-compact">
                <span class="unit-label">(0-20)</span>
              </div>
              <div class="mt-8">
                <button class="preset-btn-sm btn-preset" data-pursuit-speed="2">2ğŸŒ</button>
                <button class="preset-btn-sm btn-preset" data-pursuit-speed="5">5</button>
                <button class="preset-btn-sm btn-preset active" data-pursuit-speed="10">10âœ“</button>
                <button class="preset-btn-sm btn-preset" data-pursuit-speed="15">15</button>
                <button class="preset-btn-sm btn-preset" data-pursuit-speed="20">20âš¡</button>
              </div>
            </div>
          </div>
        </div>

        <div class="button-group">
          <button class="button btn-success" id="btnActivatePursuit">â–¶ DÃ©marrer</button>
          <button class="button btn-danger" id="btnStopPursuit">â¹ ArrÃªter</button>
        </div>
      </div>
    </div>
    <!-- END MODE POURSUITE -->

    <!-- MODE OSCILLATION Tab Content -->
    <div class="tab-content hidden-until-calibrated" id="tabOscillation">
      <div class="controls">
        
        <!-- Help Section (masquÃ©e par dÃ©faut) -->
        <div id="oscHelpSection" style="display: none; background: #fff3cd; border-left: 4px solid #ffc107; padding: 12px; margin-bottom: 15px; border-radius: 4px; font-size: 12px;">
          <strong style="color: #856404;">ğŸ’¡ Conseils d'utilisation:</strong>
          <ul style="margin: 8px 0 0 20px; color: #856404;">
            <li><strong>Forme sinusoÃ¯dale:</strong> Mouvement fluide et doux, idÃ©al pour tests mÃ©caniques (comme une vague ğŸŒŠ)</li>
            <li><strong>Forme triangle:</strong> AccÃ©lÃ©ration/dÃ©cÃ©lÃ©ration linÃ©aire constante (mouvement mÃ©canique)</li>
            <li><strong>Forme carrÃ©e:</strong> Changements de direction instantanÃ©s (attention aux contraintes mÃ©caniques!)</li>
            <li><strong>Rampes:</strong> Ã‰vitent les Ã -coups au dÃ©marrage/arrÃªt en augmentant/rÃ©duisant progressivement l'amplitude</li>
            <li><strong>Limites auto:</strong> L'amplitude est automatiquement limitÃ©e aux bornes calibrÃ©es</li>
            <li><strong>Modification temps rÃ©el:</strong> Vous pouvez changer les paramÃ¨tres pendant l'oscillation!</li>
          </ul>
        </div>

        <!-- Configuration principale - COMPACT -->
        <div class="form-row-compact">
          <!-- Centre -->
          <div class="form-group-compact d-block">
            <div>
              <label class="label-inline">Centre:</label>
              <input type="number" id="oscCenter" min="0" step="0.1" value="0" class="input-compact">
              <span class="unit-label">mm</span>
            </div>
            <div class="mt-8">
              <button class="preset-btn-sm btn-preset" data-osc-center="25">25mm</button>
              <button class="preset-btn-sm btn-preset" data-osc-center="50">50mm</button>
              <button class="preset-btn-sm btn-preset" data-osc-center="75">75mm</button>
              <button class="preset-btn-sm btn-preset" data-osc-center="110">110mm</button>
            </div>
          </div>
          
          <!-- Amplitude -->
          <div class="form-group-compact d-block">
            <div>
              <label class="label-inline">Amplitude Â±:</label>
              <input type="number" id="oscAmplitude" min="1" step="0.1" value="20" class="input-compact">
              <span class="unit-label">mm</span>
            </div>
            <div class="mt-8">
              <button class="preset-btn-sm btn-preset" data-osc-amplitude="10">10mm</button>
              <button class="preset-btn-sm btn-preset" data-osc-amplitude="25">25mm</button>
              <button class="preset-btn-sm btn-preset" data-osc-amplitude="50">50mm</button>
              <button class="preset-btn-sm btn-preset" data-osc-amplitude="75">75mm</button>
              <button class="preset-btn-sm btn-preset" data-osc-amplitude="100">100mm</button>
            </div>
          </div>
        </div>
        
        <!-- Warning limite (compact) -->
        <div id="oscLimitWarning" style="display:none; color: #f44336; font-size: 12px; padding: 5px 10px; background: #ffe5e5; border-radius: 4px; margin-bottom: 10px;">
          âš ï¸ Limites dÃ©passÃ©es! Ajuster centre ou amplitude.
        </div>
        
        <!-- SÃ©parateur -->
        <div class="divider"></div>
        
        <!-- Forme + FrÃ©quence inline -->
        <div class="speed-control-inline mb-12">
          <label class="label-inline">Forme:</label>
          <select id="oscWaveform" style="width: 150px; padding: 5px; font-size: 12px; border: 2px solid #ddd; border-radius: 4px;">
            <option value="0">SinusoÃ¯dale</option>
            <option value="1">Triangle</option>
            <option value="2">CarrÃ©e</option>
          </select>
          <label class="label-inline" style="margin-left: 15px;">FrÃ©quence:</label>
          <input type="number" id="oscFrequency" min="0.01" max="10" step="0.01" value="0.5" class="input-compact">
          <span class="unit-label">Hz</span>
          <button class="preset-btn-sm btn-preset" data-osc-frequency="0.1">0.1Hz</button>
          <button class="preset-btn-sm btn-preset" data-osc-frequency="0.25">0.25Hz</button>
          <button class="preset-btn-sm btn-preset" data-osc-frequency="0.5">0.5Hz</button>
          <button class="preset-btn-sm btn-preset" data-osc-frequency="1">1Hz</button>
          <button class="preset-btn-sm btn-preset" data-osc-frequency="2">2Hz</button>
        </div>
        
        <!-- SÃ©parateur -->
        <div class="divider"></div>

        <!-- Rampes inline (pas d'accordion) -->
        <div class="speed-control-inline mb-10">
          <label style="display: flex; align-items: center; cursor: pointer;">
            <input type="checkbox" id="oscRampInEnable" checked style="width: auto; margin-right: 5px;">
            <span class="text-md">Rampe entrÃ©e:</span>
          </label>
          <input type="number" id="oscRampInDuration" min="100" step="100" value="2000" class="input-compact" style="width: 70px;">
          <span class="unit-label">ms</span>
          
          <label style="display: flex; align-items: center; cursor: pointer; margin-left: 20px;">
            <input type="checkbox" id="oscRampOutEnable" checked style="width: auto; margin-right: 5px;">
            <span class="text-md">Rampe sortie:</span>
          </label>
          <input type="number" id="oscRampOutDuration" min="100" step="100" value="2000" class="input-compact" style="width: 70px;">
          <span class="unit-label">ms</span>
        </div>
        
        <!-- Cycles + Retour centre inline -->
        <div class="speed-control-inline mb-12">
          <label class="label-inline">Cycles:</label>
          <input type="number" id="oscCycleCount" min="0" step="1" value="0" class="input-compact" style="width: 60px;">
          <span class="unit-label" style="font-size: 11px;">(0=Infini)</span>
          
          <label style="display: flex; align-items: center; cursor: pointer; margin-left: 20px;">
            <input type="checkbox" id="oscReturnCenter" checked style="width: auto; margin-right: 5px;">
            <span class="text-md">Retour centre</span>
          </label>
        </div>
        
        <!-- SÃ©parateur -->
        <div class="divider"></div>

        <!-- Ã‰tat temps rÃ©el - COMPACT -->
        <div style="background: #e3f2fd; padding: 10px; border-radius: 4px; margin-bottom: 15px;">
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 12px;">
            <div>
              <strong>Amplitude:</strong>
              <span id="oscCurrentAmplitude" style="color: #f5576c; font-weight: bold;">--</span> mm
            </div>
            <div>
              <strong>Cycles:</strong>
              <span id="oscCompletedCycles" style="color: #f5576c; font-weight: bold;">0</span>
            </div>
            <div>
              <strong>Rampe:</strong>
              <span id="oscRampStatus" class="text-muted">--</span>
            </div>
            <div>
              <strong>Limites:</strong>
              <span id="oscLimitStatus" style="font-weight: bold;">--</span>
            </div>
          </div>
        </div>
        
        <!-- ===== CYCLE PAUSE SECTION (OSCILLATION) ===== -->
        <div class="section-collapsible collapsed" style="margin-bottom: 20px;">
          <div class="section-collapsible-header" onclick="toggleCyclePauseOscSection()">
            <span class="collapse-icon">â–¼</span> <span id="cyclePauseOscHeaderText">â¸ï¸ Pause entre cycles - dÃ©sactivÃ©e</span>
          </div>
          
          <div class="section-collapsible-content">
            <!-- Mode Selection: Fixed / Random -->
            <div class="speed-control-inline" style="margin-bottom: 15px;">
              <label class="label-inline">Mode:</label>
              <label style="margin-right: 15px; font-size: 13px;">
                <input type="radio" name="cyclePauseModeOsc" value="fixed" id="pauseModeFixedOsc" checked style="margin-right: 5px;">
                â±ï¸ Fixe
              </label>
              <label style="font-size: 13px;">
                <input type="radio" name="cyclePauseModeOsc" value="random" id="pauseModeRandomOsc" style="margin-right: 5px;">
                ğŸ² AlÃ©atoire
              </label>
            </div>
            
            <!-- Fixed Mode: Single Duration -->
            <div id="pauseFixedControlsOsc" class="speed-control-inline mb-10">
              <label class="label-inline">DurÃ©e:</label>
              <input type="number" id="cyclePauseDurationOsc" min="0.1" max="60" step="0.1" value="1.5" class="input-compact">
              <span class="unit-label">s</span>
              <button class="preset-btn-sm btn-preset" data-pause-duration-osc="0.5">0.5s</button>
              <button class="preset-btn-sm btn-preset active" data-pause-duration-osc="1.5">1.5s</button>
              <button class="preset-btn-sm btn-preset" data-pause-duration-osc="3">3s</button>
              <button class="preset-btn-sm btn-preset" data-pause-duration-osc="5">5s</button>
              <button class="preset-btn-sm btn-preset" data-pause-duration-osc="10">10s</button>
            </div>
            
            <!-- Random Mode: Min/Max Range -->
            <div id="pauseRandomControlsOsc" class="hidden">
              <div class="speed-control-inline mb-10">
                <label class="label-inline">Min:</label>
                <input type="number" id="cyclePauseMinOsc" min="0.1" max="60" step="0.1" value="1.5" class="input-compact">
                <span class="unit-label">s</span>
                <button class="preset-btn-sm btn-preset" data-pause-min-osc="0.5">0.5s</button>
                <button class="preset-btn-sm btn-preset active" data-pause-min-osc="1.5">1.5s</button>
                <button class="preset-btn-sm btn-preset" data-pause-min-osc="3">3s</button>
              </div>
              
              <div class="speed-control-inline mb-10">
                <label class="label-inline">Max:</label>
                <input type="number" id="cyclePauseMaxOsc" min="0.1" max="60" step="0.1" value="5.0" class="input-compact">
                <span class="unit-label">s</span>
                <button class="preset-btn-sm btn-preset" data-pause-max-osc="3">3s</button>
                <button class="preset-btn-sm btn-preset active" data-pause-max-osc="5">5s</button>
                <button class="preset-btn-sm btn-preset" data-pause-max-osc="10">10s</button>
                <button class="preset-btn-sm btn-preset" data-pause-max-osc="15">15s</button>
              </div>
            </div>
            
            <!-- Real-time Pause Indicator -->
            <div id="cyclePauseStatusOsc" style="margin-top: 10px; padding: 8px; background: #f0f0f0; border-radius: 5px; font-size: 13px; text-align: center; display: none;">
              <strong>â±ï¸ En pause:</strong> <span id="cyclePauseRemainingOsc">0.0s</span> restantes
            </div>
          </div>
        </div>
        
        <!-- Boutons de contrÃ´le (comme Simple - en bas) -->
        <div class="button-group">
          <button class="button btn-success" id="btnStartOscillation">â–¶ï¸ DÃ©marrer</button>
          <button class="button btn-warning" id="btnPauseOscillation">â¸ Pause</button>
          <button class="button btn-danger" id="btnStopOscillation">â¹ï¸ ArrÃªter</button>
          <button class="button btn-info" id="btnManagePlaylistOscillation">
            ğŸ“‹ Playlist (0/20)
          </button>
          <button class="button btn-help" onclick="toggleOscHelp()" style="padding: 12px 20px;">â“</button>
        </div>
        

      </div>
    </div>
    <!-- END MODE OSCILLATION -->

    <!-- MODE CHAOS Tab Content -->
    <div class="tab-content hidden-until-calibrated" id="tabChaos">
      <div class="controls">
        
        <!-- Help Section (masquÃ©e par dÃ©faut) -->
        <div id="chaosHelpSection" style="display: none; background: #fff3cd; border-left: 4px solid #ffc107; padding: 12px; margin-bottom: 15px; border-radius: 4px; font-size: 12px;">
          <strong style="color: #856404;">ğŸ’¡ Patterns Chaos (11 patterns):</strong>
          <p style="margin: 8px 0 0 0; color: #856404; font-weight: bold;">ğŸŒŠ Patterns DOUX (mouvements continus - 45%):</p>
          <ul style="margin: 5px 0 10px 20px; color: #856404;">
            <li><strong>WAVE:</strong> Vagues lentes et continues, fluide, 25-75% vitesse, 4-8s</li>
            <li><strong>PENDULUM:</strong> Balancier rÃ©gulier, oscillations douces, 30-90% vitesse, 3-6s</li>
            <li><strong>SPIRAL:</strong> Spirale progressive expansion/contraction, 20-75% vitesse, 5-10s</li>
            <li><strong>BREATHING:</strong> Respiration apaisante, petites amplitudes 10-50%, pauses alÃ©atoires, 15-60% vitesse, 2-5s</li>
          </ul>
          <p style="margin: 8px 0 0 0; color: #856404; font-weight: bold;">âš¡ Patterns DYNAMIQUES (sauts de position - 55%):</p>
          <ul style="margin: 5px 0 10px 20px; color: #856404;">
            <li><strong>ZIGZAG:</strong> Va-et-vient modÃ©rÃ©s, sauts max 60%, 40-100% vitesse, 1-2.5s</li>
            <li><strong>SWEEP:</strong> Balayages bout-Ã -bout, 30-90% vitesse, 2-4s</li>
            <li><strong>PULSE:</strong> Impulsions depuis centre Â±40%, 50-100% vitesse, 0.8-1.5s</li>
            <li><strong>DRIFT:</strong> DÃ©rive micro-changements 25%, 20-70% vitesse, 3-6s</li>
            <li><strong>BURST:</strong> Sauts ultrarapides 70%, 60-100% vitesse, 0.6-1.2s</li>
            <li><strong>BRUTE FORCE:</strong> BÃ©lier 3 phases: entrÃ©e rapide 70-100%, sortie lente 20-30%, pause 200-1500ms</li>
            <li><strong>LIBERATOR:</strong> Extraction 3 phases: entrÃ©e lente 20-30%, sortie rapide 70-100%, pause 200-1500ms</li>
          </ul>
          <p style="margin: 8px 0 0 0; color: #856404;">
            âœ¨ <strong>45% doux, 55% dynamiques.</strong> DegrÃ© de folie module vitesse/durÃ©e/sauts/pauses.
          </p>
        </div>

        <!-- Configuration principale -->
        <div class="form-row-compact">
          <div class="form-group-compact d-block">
            <div>
              <label class="label-inline">Centre:</label>
              <input type="number" id="chaosCenterPos" min="0" step="0.1" value="110" class="input-compact">
              <span class="unit-label">mm</span>
            </div>
            <div class="mt-8">
              <button class="preset-btn-sm btn-preset" data-chaos-center="25">25mm</button>
              <button class="preset-btn-sm btn-preset" data-chaos-center="50">50mm</button>
              <button class="preset-btn-sm btn-preset" data-chaos-center="75">75mm</button>
              <button class="preset-btn-sm btn-preset" data-chaos-center="110">110mm</button>
            </div>
          </div>
          <div class="form-group-compact d-block">
            <div>
              <label class="label-inline">Amplitude Â±:</label>
              <input type="number" id="chaosAmplitude" min="1" step="0.1" value="50" class="input-compact">
              <span class="unit-label">mm</span>
            </div>
            <div class="mt-8">
              <button class="preset-btn-sm btn-preset" data-chaos-amplitude="10">10mm</button>
              <button class="preset-btn-sm btn-preset" data-chaos-amplitude="25">25mm</button>
              <button class="preset-btn-sm btn-preset" data-chaos-amplitude="50">50mm</button>
              <button class="preset-btn-sm btn-preset" data-chaos-amplitude="75">75mm</button>
              <button class="preset-btn-sm btn-preset" data-chaos-amplitude="100">100mm</button>
            </div>
          </div>
        </div>

        <!-- SÃ©parateur -->
        <div class="divider"></div>

        <!-- Vitesse max -->
        <div class="speed-control-inline mb-12">
          <label class="label-inline">Vitesse max:</label>
          <input type="number" id="chaosMaxSpeed" min="0.5" max="20" step="0.5" value="10" class="input-compact">
          <button class="preset-btn-sm btn-preset" data-chaos-speed="0.5">0.5 ğŸŒ</button>
          <button class="preset-btn-sm btn-preset" data-chaos-speed="1">1</button>
          <button class="preset-btn-sm btn-preset" data-chaos-speed="2">2</button>
          <button class="preset-btn-sm btn-preset" data-chaos-speed="5">5 âœ“</button>
          <button class="preset-btn-sm btn-preset" data-chaos-speed="10">10</button>
          <button class="preset-btn-sm btn-preset" data-chaos-speed="15">15</button>
          <button class="preset-btn-sm btn-preset" data-chaos-speed="20">20 âš¡</button>
        </div>

        <!-- DegrÃ© de folie -->
        <div class="speed-control-inline mb-12">
          <label class="label-inline">ğŸ”¥ DegrÃ© folie: <span id="crazinessValue" style="font-weight: bold; color: #C850C0;">50</span>%</label>
          <input type="range" id="chaosCraziness" min="0" max="100" step="5" value="50" style="width: 180px; margin-left: 10px;">
          <button class="preset-btn-sm btn-preset" data-chaos-craziness="0">0% ğŸ˜´</button>
          <button class="preset-btn-sm btn-preset" data-chaos-craziness="25">25%</button>
          <button class="preset-btn-sm btn-preset" data-chaos-craziness="50">50% âœ“</button>
          <button class="preset-btn-sm btn-preset" data-chaos-craziness="75">75%</button>
          <button class="preset-btn-sm btn-preset" data-chaos-craziness="100">100% ğŸ”¥</button>
        </div>

        <!-- DurÃ©e -->
        <div class="speed-control-inline mb-12">
          <label class="label-inline">DurÃ©e:</label>
          <input type="number" id="chaosDuration" min="0" step="1" value="0" class="input-compact" style="width: 70px;">
          <span class="unit-label">s (0=Infini)</span>
          <button class="preset-btn-sm btn-preset" data-chaos-duration="30">30s</button>
          <button class="preset-btn-sm btn-preset" data-chaos-duration="60">60s</button>
          <button class="preset-btn-sm btn-preset" data-chaos-duration="120">120s</button>
          <button class="preset-btn-sm btn-preset" data-chaos-duration="0">âˆ</button>
        </div>

        <!-- SÃ©parateur -->
        <div class="divider"></div>

        <!-- Accordion: Options avancÃ©es -->
        <details style="margin-bottom: 15px; border: 1px solid #ddd; border-radius: 4px; padding: 10px; background: #f9f9f9;">
          <summary style="cursor: pointer; font-weight: bold; font-size: 13px; color: #333;">â–¼ Options avancÃ©es</summary>
          
          <!-- Patterns actifs -->
          <div style="margin-top: 10px; padding: 10px; background: #e8f5e9; border-radius: 4px; border-left: 3px solid #4caf50;">
            <label style="font-weight: bold; font-size: 12px; display: block; margin-bottom: 8px;">âœ… Patterns actifs:</label>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-bottom: 8px;">
              <label style="display: flex; align-items: center; background: white; padding: 5px; border-radius: 3px; cursor: pointer; font-size: 11px;">
                <input type="checkbox" id="patternWave" checked style="margin-right: 5px; transform: scale(1.1);">
                <span>ğŸŒŠ WAVE</span>
              </label>
              <label style="display: flex; align-items: center; background: white; padding: 5px; border-radius: 3px; cursor: pointer; font-size: 11px;">
                <input type="checkbox" id="patternPendulum" checked style="margin-right: 5px; transform: scale(1.1);">
                <span>ğŸ¯ PENDULUM</span>
              </label>
              <label style="display: flex; align-items: center; background: white; padding: 5px; border-radius: 3px; cursor: pointer; font-size: 11px;">
                <input type="checkbox" id="patternSpiral" checked style="margin-right: 5px; transform: scale(1.1);">
                <span>ğŸŒ€ SPIRAL</span>
              </label>
              <label style="display: flex; align-items: center; background: white; padding: 5px; border-radius: 3px; cursor: pointer; font-size: 11px;">
                <input type="checkbox" id="patternZigzag" checked style="margin-right: 5px; transform: scale(1.1);">
                <span>âš¡ ZIGZAG</span>
              </label>
              <label style="display: flex; align-items: center; background: white; padding: 5px; border-radius: 3px; cursor: pointer; font-size: 11px;">
                <input type="checkbox" id="patternSweep" checked style="margin-right: 5px; transform: scale(1.1);">
                <span>â†”ï¸ SWEEP</span>
              </label>
              <label style="display: flex; align-items: center; background: white; padding: 5px; border-radius: 3px; cursor: pointer; font-size: 11px;">
                <input type="checkbox" id="patternPulse" checked style="margin-right: 5px; transform: scale(1.1);">
                <span>ğŸ’« PULSE</span>
              </label>
              <label style="display: flex; align-items: center; background: white; padding: 5px; border-radius: 3px; cursor: pointer; font-size: 11px;">
                <input type="checkbox" id="patternDrift" checked style="margin-right: 5px; transform: scale(1.1);">
                <span>ğŸŒ«ï¸ DRIFT</span>
              </label>
              <label style="display: flex; align-items: center; background: white; padding: 5px; border-radius: 3px; cursor: pointer; font-size: 11px;">
                <input type="checkbox" id="patternBurst" checked style="margin-right: 5px; transform: scale(1.1);">
                <span>ğŸ”¥ BURST</span>
              </label>
              <label style="display: flex; align-items: center; background: white; padding: 5px; border-radius: 3px; cursor: pointer; font-size: 11px;">
                <input type="checkbox" id="patternCalm" checked style="margin-right: 5px; transform: scale(1.1);">
                <span>ğŸ˜Œ BREATHING</span>
              </label>
              <label style="display: flex; align-items: center; background: white; padding: 5px; border-radius: 3px; cursor: pointer; font-size: 11px;">
                <input type="checkbox" id="patternBruteForce" checked style="margin-right: 5px; transform: scale(1.1);">
                <span>ğŸ”¨ BRUTE FORCE</span>
              </label>
              <label style="display: flex; align-items: center; background: white; padding: 5px; border-radius: 3px; cursor: pointer; font-size: 11px;">
                <input type="checkbox" id="patternLiberator" checked style="margin-right: 5px; transform: scale(1.1);">
                <span>ğŸ”“ LIBERATOR</span>
              </label>
            </div>
            <div style="display: flex; gap: 5px; margin-top: 8px;">
              <button class="preset-btn-sm btn-preset" id="btnEnableAllPatterns" style="flex: 1; font-size: 10px; padding: 4px;">âœ… Tout</button>
              <button class="preset-btn-sm btn-preset" id="btnEnableSoftPatterns" style="flex: 1; font-size: 10px; padding: 4px;">ğŸŒŠ Doux</button>
              <button class="preset-btn-sm btn-preset" id="btnEnableDynamicPatterns" style="flex: 1; font-size: 10px; padding: 4px;">âš¡ Dynamiques</button>
            </div>
          </div>

          <!-- Seed (optionnel) -->
          <div style="margin-top: 10px;">
            <label class="label-inline text-md">Seed (optionnel):</label>
            <input type="number" id="chaosSeed" min="0" step="1" value="0" class="input-compact" style="width: 90px;">
            <span class="unit-label" style="font-size: 11px;">(0=alÃ©atoire)</span>
          </div>
        </details>

        <!-- SÃ©parateur -->
        <div class="divider"></div>

        <!-- Real-time Stats Section -->
        <div id="chaosStats" style="display: none; background: #e3f2fd; padding: 10px; border-radius: 4px; margin-bottom: 15px;">
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 12px;">
            <div><strong>Pattern:</strong> <span id="statPattern" style="color: #C850C0;">--</span></div>
            <div><strong>Position:</strong> <span id="statPosition" style="color: #2196F3;">--</span> mm</div>
            <div><strong>Plage:</strong> <span id="statRange" style="color: #2196F3;">--</span> mm</div>
            <div><strong>Patterns:</strong> <span id="statCount" style="color: #2196F3;">0</span></div>
          </div>
          <div id="statTimer" style="margin-top: 8px; text-align: center; font-size: 12px;">
            â±ï¸ Temps: <span id="statElapsed">0</span>s
          </div>
        </div>

        <!-- Boutons de contrÃ´le -->
        <div class="button-group">
          <button class="button btn-success" id="btnStartChaos">â–¶ï¸ DÃ©marrer</button>
          <button class="button btn-warning" id="btnPauseChaos">â¸ Pause</button>
          <button class="button btn-danger" id="btnStopChaos">â¹ï¸ ArrÃªter</button>
          <button class="button btn-info" id="btnManagePlaylistChaos">
            ğŸ“‹ Playlist (0/20)
          </button>
          <button class="button btn-help" onclick="toggleChaosHelp()" style="padding: 12px 20px;">â“</button>
        </div>
      </div>
    </div>
    <!-- END MODE CHAOS -->

    <!-- MODE SÃ©quenceur Tab Content -->
    <div class="tab-content hidden-until-calibrated" id="tabTableau">
      <div class="controls">
        
        <!-- Toolbar -->
        <div style="display: flex; gap: 8px; margin-bottom: 12px; flex-wrap: wrap;">
          <button class="button btn-success" id="btnAddLine" style="flex: 1; min-width: 110px; padding: 8px; font-size: 13px;">â• Ajouter</button>
          <button class="button btn-warning" id="btnClearAll" style="flex: 1; min-width: 110px; padding: 8px; font-size: 13px;">ğŸ—‘ï¸ Effacer</button>
          <button class="button btn-primary" id="btnImportSeq" style="flex: 1; min-width: 110px; padding: 8px; font-size: 13px;">ğŸ“¥ Import</button>
          <button class="button btn-primary" id="btnExportSeq" style="flex: 1; min-width: 110px; padding: 8px; font-size: 13px;">ğŸ“¤ Export</button>
          <button class="button btn-info" id="btnDownloadTemplate" style="flex: 1; min-width: 110px; padding: 8px; font-size: 13px; background: #17a2b8;" title="TÃ©lÃ©charger un template JSON avec exemples">ğŸ“„ Template</button>
        </div>

        <!-- Phase 2: Batch Operations Toolbar (hidden by default) -->
        <div id="sequenceBatchToolbar" class="sequence-batch-toolbar">
          <div class="sequence-batch-info">
            <span id="batchSelectionCount">0 ligne(s) sÃ©lectionnÃ©e(s)</span>
          </div>
          <div class="sequence-batch-actions">
            <button class="sequence-batch-btn" onclick="batchEnableLines(true)">
              <span>âœ“</span> Activer
            </button>
            <button class="sequence-batch-btn" onclick="batchEnableLines(false)">
              <span>âœ—</span> DÃ©sactiver
            </button>
            <div id="sequenceTrashZone" class="sequence-trash-zone">
              <span class="trash-icon">ğŸ—‘ï¸</span>
              <span>Glisser ici</span>
            </div>
            <button class="sequence-batch-btn" onclick="clearSelection()">
              <span>âœ–</span> Annuler
            </button>
          </div>
        </div>

        <!-- Sequence Table Container -->
        <div style="overflow-x: auto; margin-bottom: 20px; border: 2px solid #ddd; border-radius: 8px; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
          <table id="sequenceTable" style="width: 100%; border-collapse: collapse; font-size: 11px;">
            <thead>
              <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <th style="padding: 8px 4px; text-align: center; border-right: 1px solid rgba(255,255,255,0.2); width: 30px;">âœ“</th>
                <th style="padding: 8px 4px; text-align: center; border-right: 1px solid rgba(255,255,255,0.2); width: 30px;">#</th>
                <th style="padding: 8px 4px; text-align: center; border-right: 1px solid rgba(255,255,255,0.2); width: 40px;">Type</th>
                <th style="padding: 8px 6px; text-align: center; border-right: 1px solid rgba(255,255,255,0.2);">DÃ©but<br><small style="font-size: 9px;">(mm)</small></th>
                <th style="padding: 8px 6px; text-align: center; border-right: 1px solid rgba(255,255,255,0.2);">Dist.<br><small style="font-size: 9px;">(mm)</small></th>
                <th style="padding: 8px 6px; text-align: center; border-right: 1px solid rgba(255,255,255,0.2);">Vitesses<br><small style="font-size: 9px;">A/R</small></th>
                <th style="padding: 8px 6px; text-align: center; border-right: 1px solid rgba(255,255,255,0.2);">DÃ©cel.</th>
                <th style="padding: 8px 4px; text-align: center; border-right: 1px solid rgba(255,255,255,0.2); width: 45px;">Cycles</th>
                <th style="padding: 8px 4px; text-align: center; border-right: 1px solid rgba(255,255,255,0.2); width: 50px;">â±ï¸<br><small style="font-size: 9px;">(s)</small></th>
                <th style="padding: 8px 4px; text-align: center;">Actions</th>
              </tr>
            </thead>
            <tbody id="sequenceTableBody">
              <tr>
                <td colspan="10" style="padding: 40px; text-align: center; color: #999;">
                  <div style="font-size: 48px; margin-bottom: 10px;">ğŸ“‹</div>
                  <div style="font-size: 16px;">Aucune ligne - Cliquez sur "â• Ajouter ligne" pour commencer</div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Permanent Trash Drop Zone -->
        <div id="sequenceTrashDropZone" class="sequence-trash-drop-zone">
          <span class="trash-icon">ğŸ—‘ï¸</span>
          <span>Glisser une ligne ici pour la supprimer</span>
        </div>

        <!-- Execution Controls -->
        <div style="background: #f5f5f5; padding: 12px; border-radius: 8px; margin-bottom: 15px;">
          <div style="display: flex; gap: 8px; margin-bottom: 12px; flex-wrap: wrap;">
            <button class="button btn-success" id="btnStartSequence" style="flex: 1; min-width: 130px; font-size: 14px; padding: 10px;">
              â–¶ï¸ Unique
            </button>
            <button class="button btn-primary" id="btnLoopSequence" style="flex: 1; min-width: 130px; font-size: 14px; padding: 10px; background: #FF9800;">
              ğŸ” Boucle
            </button>
            <button class="button btn-warning" id="btnPauseSequence" style="flex: 1; min-width: 90px; font-size: 14px; padding: 10px;" disabled>
              â¸ï¸ Pause
            </button>
            <button class="button btn-danger" id="btnStopSequence" style="flex: 1; min-width: 90px; font-size: 14px; padding: 10px;" disabled>
              â¹ï¸ Stop
            </button>
            <button class="button btn-primary" id="btnSkipLine" style="flex: 1; min-width: 110px; font-size: 14px; padding: 10px; background: #9C27B0;" disabled>
              â­ï¸ Suivant
            </button>
          </div>

          <!-- Sequence Status - COMPACT -->
          <div style="display: flex; gap: 20px; flex-wrap: wrap; font-size: 12px; padding: 10px 15px; background: white; border-radius: 6px; border: 1px solid #ddd;">
            <div><span class="text-muted">Mode:</span> <strong id="seqMode" style="color: #333;">ArrÃªtÃ©</strong></div>
            <div><span class="text-muted">Ligne:</span> <strong id="seqCurrentLine" style="color: #2196F3;">-- / --</strong></div>
            <div><span class="text-muted">Cycle:</span> <strong id="seqLineCycle" style="color: #4CAF50;">--</strong></div>
            <div><span class="text-muted">Boucles:</span> <strong id="seqLoopCount" style="color: #FF9800;">0</strong></div>
            <div><span class="text-muted">â±ï¸ Pause:</span> <strong id="seqPauseRemaining" style="color: #9C27B0;">-- ms</strong></div>
          </div>
        </div>

      </div>
    </div>
    <!-- END MODE SÃ©quenceur -->

    <!-- Modal for Line Editing -->
    <div id="editLineModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 9999; overflow-y: auto;" onclick="closeEditLineModalOnOverlayClick(event)">
      <div style="max-width: 600px; margin: 50px auto; background: white; border-radius: 10px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); overflow: hidden;" onclick="event.stopPropagation()">
        
        <!-- Modal Header -->
        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; display: flex; justify-content: space-between; align-items: center;">
          <h3 style="margin: 0; font-size: 20px;">âœï¸ Ã‰diter la ligne #<span id="editLineNumber">--</span></h3>
          <button id="btnCloseModal" style="background: rgba(255,255,255,0.2); border: none; color: white; font-size: 24px; cursor: pointer; width: 35px; height: 35px; border-radius: 50%; line-height: 1;">Ã—</button>
        </div>

        <!-- Modal Body -->
        <div style="padding: 25px;">
          <form id="editLineForm">
            
            <!-- Movement Type Selection -->
            <div class="type-selection-row">
              <label class="label-inline">ğŸ›ï¸ Type:</label>
              <div class="type-selection-buttons">
                <label class="radio-label-inline">
                  <input type="radio" name="movementType" id="editTypeVaet" value="0" checked style="width: auto;">
                  <span>ğŸ”„ Va-et-vient</span>
                </label>
                <label class="radio-label-inline">
                  <input type="radio" name="movementType" id="editTypeOsc" value="1" style="width: auto;">
                  <span>ã€°ï¸ Oscillation</span>
                </label>
                <label class="radio-label-inline">
                  <input type="radio" name="movementType" id="editTypeChaos" value="2" style="width: auto;">
                  <span>ğŸŒ€ Chaos</span>
                </label>
                <label class="radio-label-inline">
                  <input type="radio" name="movementType" id="editTypeCalibration" value="4" style="width: auto;">
                  <span>ğŸ“ Calibration</span>
                </label>
              </div>
            </div>

            <!-- PLAYLIST PRESETS LOADING (for all modes) -->
            <div id="playlistLoaderSimple" style="background: #E3F2FD; padding: 12px; margin: 15px 0; border-radius: 6px; border: 2px solid #2196F3;">
              <label style="font-weight: 500; color: #1976D2; display: block; margin-bottom: 8px;">ğŸ“‹ Charger un preset Simple:</label>
              <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                <select id="editSimplePresetSelect" onchange="previewSequencerPreset('simple', this.value)" style="flex: 1; padding: 8px; border: 1px solid #2196F3; border-radius: 4px;">
                  <option value="">-- SÃ©lectionner un preset --</option>
                </select>
                <button type="button" onclick="previewSequencerPreset('simple', document.getElementById('editSimplePresetSelect').value)" style="padding: 8px 12px; background: #64B5F6; color: white; border: none; border-radius: 4px; cursor: pointer;" title="Voir les dÃ©tails">
                  ğŸ‘ï¸
                </button>
              </div>
              <button type="button" onclick="loadPresetIntoSequencerModal('simple')" style="width: 100%; padding: 8px; background: #2196F3; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 500;">
                â¬‡ï¸ Charger les valeurs
              </button>
            </div>

            <div id="playlistLoaderOscillation" style="background: #FFF3E0; padding: 12px; margin: 15px 0; border-radius: 6px; border: 2px solid #FF9800; display: none;">
              <label style="font-weight: 500; color: #F57C00; display: block; margin-bottom: 8px;">ğŸ“‹ Charger un preset Oscillation:</label>
              <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                <select id="editOscillationPresetSelect" onchange="previewSequencerPreset('oscillation', this.value)" style="flex: 1; padding: 8px; border: 1px solid #FF9800; border-radius: 4px;">
                  <option value="">-- SÃ©lectionner un preset --</option>
                </select>
                <button type="button" onclick="previewSequencerPreset('oscillation', document.getElementById('editOscillationPresetSelect').value)" style="padding: 8px 12px; background: #FFB74D; color: white; border: none; border-radius: 4px; cursor: pointer;" title="Voir les dÃ©tails">
                  ğŸ‘ï¸
                </button>
              </div>
              <button type="button" onclick="loadPresetIntoSequencerModal('oscillation')" style="width: 100%; padding: 8px; background: #FF9800; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 500;">
                â¬‡ï¸ Charger les valeurs
              </button>
            </div>

            <div id="playlistLoaderChaos" style="background: #FCE4EC; padding: 12px; margin: 15px 0; border-radius: 6px; border: 2px solid #E91E63; display: none;">
              <label style="font-weight: 500; color: #C2185B; display: block; margin-bottom: 8px;">ğŸ“‹ Charger un preset Chaos:</label>
              <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                <select id="editChaosPresetSelect" onchange="previewSequencerPreset('chaos', this.value)" style="flex: 1; padding: 8px; border: 1px solid #E91E63; border-radius: 4px;">
                  <option value="">-- SÃ©lectionner un preset --</option>
                </select>
                <button type="button" onclick="previewSequencerPreset('chaos', document.getElementById('editChaosPresetSelect').value)" style="padding: 8px 12px; background: #F06292; color: white; border: none; border-radius: 4px; cursor: pointer;" title="Voir les dÃ©tails">
                  ğŸ‘ï¸
                </button>
              </div>
              <button type="button" onclick="loadPresetIntoSequencerModal('chaos')" style="width: 100%; padding: 8px; background: #E91E63; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 500;">
                â¬‡ï¸ Charger les valeurs
              </button>
            </div>

            <!-- VA-ET-VIENT FIELDS -->
            <div id="vaetFields">
              <!-- Position & Distance -->
              <div class="grid-2col-12">
                <div>
                  <label class="label-inline">Position dÃ©part:</label>
                  <input type="number" name="startPositionMM" id="editStartPos" step="0.1" min="0" class="input-modal">
                </div>
                <div>
                  <label class="label-inline">Distance (mm):</label>
                  <input type="number" name="distanceMM" id="editDistance" step="0.1" min="1" class="input-modal">
                </div>
              </div>

              <!-- Speeds -->
              <div class="grid-2col-12">
                <div>
                  <label class="label-inline">Vitesse aller (/20):</label>
                  <input type="number" name="speedForward" id="editSpeedFwd" min="0" max="20" step="0.1" value="5.0" class="input-modal">
                </div>
                <div>
                  <label class="label-inline">Vitesse retour (/20):</label>
                  <input type="number" name="speedBackward" id="editSpeedBack" min="0" max="20" step="0.1" value="5.0" class="input-modal">
                </div>
              </div>

              <!-- Deceleration Section -->
              <fieldset style="border: 1px solid #667eea; border-radius: 6px; padding: 10px; margin-bottom: 10px;">
                <legend style="color: #667eea; font-weight: 500; padding: 0 8px; font-size: 12px;">DÃ©cÃ©lÃ©ration</legend>
                
                <div class="flex-gap-15 mb-8 text-md">
                  <label style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
                    <input type="checkbox" name="decelStartEnabled" id="editDecelStart" style="width: 16px; height: 16px;">
                    <span>Activer DÃ‰BUT</span>
                  </label>
                  <label style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
                    <input type="checkbox" name="decelEndEnabled" id="editDecelEnd" style="width: 16px; height: 16px;" checked>
                    <span>Activer FIN</span>
                  </label>
                </div>

                <div class="grid-2col-12" style="margin-bottom: 8px; gap: 10px;">
                  <div>
                    <label class="label-inline">Zone (mm):</label>
                    <input type="number" name="decelZoneMM" id="editDecelZone" min="10" max="200" step="5" value="20" class="input-modal">
                  </div>
                  <div>
                    <label class="label-inline">Effet (%): <span id="editEffectValue" style="font-weight: bold; color: #667eea;">50</span></label>
                    <input type="range" name="decelEffectPercent" id="editDecelEffect" min="0" max="100" step="5" value="50" style="width: 100%; margin-top: 3px;">
                  </div>
                </div>

                <div>
                  <label class="label-inline">Mode courbe:</label>
                  <select name="decelMode" id="editDecelMode" class="input-modal">
                    <option value="0">LinÃ©aire</option>
                    <option value="1" selected>SinusoÃ¯dal</option>
                    <option value="2">Triangle InversÃ©</option>
                    <option value="3">Sinus InversÃ©</option>
                  </select>
                </div>
              </fieldset>

              <!-- Cycle Pause Section (VA-ET-VIENT) -->
              <fieldset style="border: 1px solid #f39c12; border-radius: 6px; padding: 10px; margin-bottom: 10px;">
                <legend style="color: #f39c12; font-weight: 500; padding: 0 8px; font-size: 12px;">â¸ï¸ Pause entre cycles</legend>
                
                <div class="flex-gap-15 mb-8 text-md">
                  <label style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
                    <input type="checkbox" name="vaetCyclePauseEnabled" id="editVaetPauseEnabled" style="width: 16px; height: 16px;">
                    <span>Activer pause</span>
                  </label>
                  <label style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
                    <input type="checkbox" name="vaetCyclePauseIsRandom" id="editVaetPauseRandom" style="width: 16px; height: 16px;">
                    <span>AlÃ©atoire (range)</span>
                  </label>
                </div>

                <div class="grid-2col-12" style="margin-bottom: 8px; gap: 10px;" id="vaetPauseFixedDiv">
                  <div>
                    <label class="label-inline">DurÃ©e pause (s):</label>
                    <input type="number" name="vaetCyclePauseDurationSec" id="editVaetPauseDuration" min="0" max="60" step="0.1" value="0.0" class="input-modal">
                  </div>
                </div>

                <div class="grid-2col-12" style="margin-bottom: 8px; gap: 10px; display: none;" id="vaetPauseRandomDiv">
                  <div>
                    <label class="label-inline">Min (s):</label>
                    <input type="number" name="vaetCyclePauseMinSec" id="editVaetPauseMin" min="0" max="60" step="0.1" value="0.5" class="input-modal">
                  </div>
                  <div>
                    <label class="label-inline">Max (s):</label>
                    <input type="number" name="vaetCyclePauseMaxSec" id="editVaetPauseMax" min="0" max="60" step="0.1" value="3.0" class="input-modal">
                  </div>
                </div>
              </fieldset>
            </div>
            
            <!-- END VA-ET-VIENT FIELDS -->

            <!-- OSCILLATION FIELDS -->
            <div id="oscFields" class="hidden">
              
              <!-- Center & Amplitude -->
              <div class="grid-2col-12">
                <div>
                  <label class="label-inline">Centre (mm):</label>
                  <input type="number" name="oscCenterPositionMM" id="editOscCenter" step="0.1" min="0" value="100" class="input-modal">
                </div>
                <div>
                  <label class="label-inline">Amplitude (mm):</label>
                  <input type="number" name="oscAmplitudeMM" id="editOscAmplitude" step="0.1" min="1" value="50" class="input-modal">
                </div>
              </div>

              <!-- Waveform & Frequency -->
              <div class="grid-2col-12">
                <div>
                  <label class="label-inline">Forme d'onde:</label>
                  <select name="oscWaveform" id="editOscWaveform" class="input-modal">
                    <option value="0">ã€°ï¸ SinusoÃ¯dal</option>
                    <option value="1">ğŸ“ Triangle</option>
                    <option value="2">â¬œ CarrÃ©</option>
                  </select>
                </div>
                <div>
                  <label class="label-inline">FrÃ©quence (Hz):</label>
                  <input type="number" name="oscFrequencyHz" id="editOscFrequency" step="0.01" min="0.01" max="10" value="0.5" class="input-modal">
                </div>
              </div>

              <!-- Ramping -->
              <div class="flex-gap-12" style="flex-direction: column; font-size: 12px; margin-bottom: 12px;">
                <label style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
                  <input type="checkbox" name="oscEnableRampIn" id="editOscRampIn" style="width: 16px; height: 16px;">
                  <span>Rampe entrÃ©e</span>
                </label>
                <label style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
                  <input type="checkbox" name="oscEnableRampOut" id="editOscRampOut" style="width: 16px; height: 16px;">
                  <span>Rampe sortie</span>
                </label>
              </div>

              <!-- Ramp Durations -->
              <div class="grid-2col-12">
                <div>
                  <label class="label-inline">DurÃ©e rampe IN (ms):</label>
                  <input type="number" name="oscRampInDurationMs" id="editOscRampInDur" min="100" max="10000" step="100" value="1000" class="input-modal">
                </div>
                <div>
                  <label class="label-inline">DurÃ©e rampe OUT (ms):</label>
                  <input type="number" name="oscRampOutDurationMs" id="editOscRampOutDur" min="100" max="10000" step="100" value="1000" class="input-modal">
                </div>
              </div>

              <!-- Cycle Pause Section (OSCILLATION) -->
              <fieldset style="border: 1px solid #f39c12; border-radius: 6px; padding: 10px; margin-top: 10px;">
                <legend style="color: #f39c12; font-weight: 500; padding: 0 8px; font-size: 12px;">â¸ï¸ Pause entre cycles</legend>
                
                <div class="flex-gap-15 mb-8 text-md">
                  <label style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
                    <input type="checkbox" name="oscCyclePauseEnabled" id="editOscPauseEnabled" style="width: 16px; height: 16px;">
                    <span>Activer pause</span>
                  </label>
                  <label style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
                    <input type="checkbox" name="oscCyclePauseIsRandom" id="editOscPauseRandom" style="width: 16px; height: 16px;">
                    <span>AlÃ©atoire (range)</span>
                  </label>
                </div>

                <div class="grid-2col-12" style="margin-bottom: 8px; gap: 10px;" id="oscPauseFixedDiv">
                  <div>
                    <label class="label-inline">DurÃ©e pause (s):</label>
                    <input type="number" name="oscCyclePauseDurationSec" id="editOscPauseDuration" min="0" max="60" step="0.1" value="0.0" class="input-modal">
                  </div>
                </div>

                <div class="grid-2col-12" style="margin-bottom: 8px; gap: 10px; display: none;" id="oscPauseRandomDiv">
                  <div>
                    <label class="label-inline">Min (s):</label>
                    <input type="number" name="oscCyclePauseMinSec" id="editOscPauseMin" min="0" max="60" step="0.1" value="0.5" class="input-modal">
                  </div>
                  <div>
                    <label class="label-inline">Max (s):</label>
                    <input type="number" name="oscCyclePauseMaxSec" id="editOscPauseMax" min="0" max="60" step="0.1" value="3.0" class="input-modal">
                  </div>
                </div>
              </fieldset>

            </div>
            <!-- END OSCILLATION FIELDS -->

            <!-- CHAOS FIELDS -->
            <div id="chaosFields" class="hidden">
              
              <!-- Center & Amplitude -->
              <div class="grid-2col-12">
                <div>
                  <label class="label-inline">Centre (mm):</label>
                  <input type="number" name="chaosCenterPositionMM" id="editChaosCenter" step="0.1" min="0" value="110" class="input-modal">
                </div>
                <div>
                  <label class="label-inline">Amplitude (mm):</label>
                  <input type="number" name="chaosAmplitudeMM" id="editChaosAmplitude" step="0.1" min="1" value="50" class="input-modal">
                </div>
              </div>

              <!-- Speed & Craziness -->
              <div class="grid-2col-12">
                <div>
                  <label class="label-inline">Vitesse max (/20):</label>
                  <input type="number" name="chaosMaxSpeedLevel" id="editChaosSpeed" min="1" max="20" step="0.5" value="10" class="input-modal">
                </div>
                <div>
                  <label class="label-inline">ğŸ² Folie (%):</label>
                  <input type="number" name="chaosCrazinessPercent" id="editChaosCraziness" min="0" max="100" step="5" value="50" class="input-modal">
                </div>
              </div>

              <!-- Duration & Seed -->
              <div class="grid-2col-12">
                <div>
                  <label class="label-inline">â±ï¸ DurÃ©e (s) 5-600:</label>
                  <input type="number" name="chaosDurationSeconds" id="editChaosDuration" min="5" max="600" step="5" value="30" class="input-modal">
                </div>
                <div>
                  <label class="label-inline">ğŸŒ± Seed (0=alÃ©a):</label>
                  <input type="number" name="chaosSeed" id="editChaosSeed" min="0" max="9999999" step="1" value="0" class="input-modal">
                </div>
              </div>

              <!-- Patterns Selection -->
              <div class="mb-10">
                <label class="label-inline">ğŸ­ Patterns actifs:</label>
                <div class="grid-4col-patterns">
                  <label class="checkbox-label-sm">
                    <input type="checkbox" name="chaosPattern0" checked style="width: 14px; height: 14px;">
                    <span>âš¡ ZigZag</span>
                  </label>
                  <label class="checkbox-label-sm">
                    <input type="checkbox" name="chaosPattern1" checked style="width: 14px; height: 14px;">
                    <span>ğŸ“Š Sweep</span>
                  </label>
                  <label class="checkbox-label-sm">
                    <input type="checkbox" name="chaosPattern2" checked style="width: 14px; height: 14px;">
                    <span>ğŸ’¥ Pulse</span>
                  </label>
                  <label class="checkbox-label-sm">
                    <input type="checkbox" name="chaosPattern3" checked style="width: 14px; height: 14px;">
                    <span>ğŸŒŠ Drift</span>
                  </label>
                  <label class="checkbox-label-sm">
                    <input type="checkbox" name="chaosPattern4" checked style="width: 14px; height: 14px;">
                    <span>ğŸ’¨ Burst</span>
                  </label>
                  <label class="checkbox-label-sm">
                    <input type="checkbox" name="chaosPattern5" checked style="width: 14px; height: 14px;">
                    <span>ã€°ï¸ Wave</span>
                  </label>
                  <label class="checkbox-label-sm">
                    <input type="checkbox" name="chaosPattern6" checked style="width: 14px; height: 14px;">
                    <span>âš–ï¸ Pendul</span>
                  </label>
                  <label class="checkbox-label-sm">
                    <input type="checkbox" name="chaosPattern7" checked style="width: 14px; height: 14px;">
                    <span>ğŸŒ€ Spiral</span>
                  </label>
                  <label class="checkbox-label-sm">
                    <input type="checkbox" name="chaosPattern8" checked style="width: 14px; height: 14px;">
                    <span>ğŸ˜Œ Breathing</span>
                  </label>
                  <label class="checkbox-label-sm">
                    <input type="checkbox" name="chaosPattern9" checked style="width: 14px; height: 14px;">
                    <span>ğŸ”¨ BruteForce</span>
                  </label>
                  <label class="checkbox-label-sm">
                    <input type="checkbox" name="chaosPattern10" checked style="width: 14px; height: 14px;">
                    <span>ğŸ”“ Liberator</span>
                  </label>
                </div>
              </div>

            </div>
            <!-- END CHAOS FIELDS -->

            <!-- COMMON FIELDS (Cycles & Pause) -->
            <!-- Cycles & Pause -->
            <div class="grid-2col-12 mb-12">
              <div id="cyclesFieldDiv">
                <label class="label-inline">Cycles (1-1000):</label>
                <input type="number" name="cycleCount" id="editCycles" min="1" max="1000" step="1" value="1" class="input-modal">
              </div>
              <div id="pauseFieldDiv">
                <label class="label-inline">â±ï¸ Pause (s) 0-60:</label>
                <input type="number" name="pauseAfterSec" id="editPause" min="0" max="60" step="0.1" value="0" class="input-modal">
              </div>
            </div>

            <!-- Validation Error Display -->
            <div id="editValidationErrors" style="display: none; margin-bottom: 10px; padding: 10px; background: #ffebee; border-left: 4px solid #f44336; border-radius: 5px; font-size: 12px;">
              <div style="font-weight: bold; color: #d32f2f; margin-bottom: 5px;">âŒ Erreurs de validation :</div>
              <ul id="editValidationErrorsList" style="margin: 0; padding-left: 20px; color: #c62828; font-size: 13px;">
              </ul>
            </div>

            <!-- Action Buttons -->
            <div class="flex-gap-10 flex-end">
              <button type="submit" id="btnSaveEdit" class="button btn-success" style="padding: 10px 24px; font-size: 14px;">
                ğŸ’¾ Enregistrer
              </button>
              <button type="button" id="btnCancelEdit" class="button btn-secondary" style="padding: 10px 24px; font-size: 14px; background: #999;">
                âŒ Annuler
              </button>
            </div>

          </form>
        </div>
      </div>
    </div>
    <!-- END EDIT MODAL -->

  </div>

  <!-- External JavaScript Modules -->
  <!-- Core (load first) -->
  <script src="/js/ui/milestones.js"></script>  <!-- Must load BEFORE app.js -->
  <script src="/js/core/app.js"></script>
  <script src="/js/utils/utils.js"></script>
  <script src="/js/core/DOMManager.js"></script>  <!-- Must load BEFORE main.js -->
  <script src="/js/core/websocket.js"></script>   <!-- WebSocket connection & handlers -->
  <!-- UI -->
  <script src="/js/ui/StatsController.js"></script>  <!-- Stats panel, display & charts -->
  <script src="/js/ui/ToolsController.js"></script>  <!-- Common tools (calib, logs, sys) -->
  <script src="/js/ui/UIController.js"></script>  <!-- Tab navigation & modals -->
  <!-- Utils (load before controllers) -->
  <script src="/js/utils/PlaylistUtils.js"></script>  <!-- Playlist utility functions (names, tooltips) -->
  <script src="/js/utils/SimpleUtils.js"></script>  <!-- Simple mode utilities (decel preview) -->
  <script src="/js/utils/SequenceUtils.js"></script>  <!-- Sequence display utilities -->
  <!-- Controllers -->
  <script src="/js/controllers/PlaylistController.js"></script>  <!-- Playlist management for all modes -->
  <script src="/js/controllers/SimpleController.js"></script>  <!-- Simple mode control -->
  <script src="/js/controllers/PursuitController.js"></script>  <!-- Pursuit mode gauge control -->
  <script src="/js/controllers/OscillationController.js"></script>  <!-- Oscillation mode control -->
  <script src="/js/controllers/ChaosController.js"></script>    <!-- Chaos mode control -->
  <script src="/js/controllers/SequenceController.js"></script>  <!-- Sequence table management -->
  <!-- Main (load last) -->
  <script src="/js/main.js"></script>

</body>
</html>